{"id": "bd-077e", "title": "Add close_reason field to CLI schema and documentation", "description": "PR #551 persists close_reason, but the CLI documentation may not mention this field as part of the issue schema.\n\n## Current State\n- close_reason is now persisted in database\n- `bd show --json` will return close_reason in JSON output\n- Documentation may not reflect this new field\n\n## What's Missing\n- CLI reference documentation for close_reason field\n- Schema documentation showing close_reason is a top-level issue field\n- Example output showing close_reason in bd show --json\n- bd close command documentation should mention close_reason parameter is optional\n\n## Suggested Action\n1. Update README.md or CLI reference docs to list close_reason as an issue field\n2. Add example to bd close documentation\n3. Update any type definitions or schema specs\n4. Consider adding close_reason to verbose list output (bd list --verbose)", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-12-14T14:25:28.448654-08:00", "updated_at": "2025-12-14T14:25:28.448654-08:00", "dependencies": [{"issue_id": "bd-077e", "depends_on_id": "bd-z86n", "type": "discovered-from", "created_at": "2025-12-14T14:25:28.449968-08:00", "created_by": "stevey"}]}
{"id": "bd-0a43", "title": "Split monolithic sqlite.go into focused files", "description": "internal/storage/sqlite/sqlite.go is 1050 lines containing initialization, 20+ CRUD methods, query building, and schema management.\n\nSplit into:\n- store.go: Store struct & initialization (150 lines)\n- bead_queries.go: Bead CRUD (300 lines)\n- work_queries.go: Work queries (200 lines)  \n- stats_queries.go: Statistics (150 lines)\n- schema.go: Schema & migrations (150 lines)\n- helpers.go: Common utilities (100 lines)\n\nImpact: Impossible to understand at a glance; hard to find specific functionality; high cognitive load\n\nEffort: 6-8 hours", "status": "open", "priority": 0, "issue_type": "task", "created_at": "2025-11-16T14:51:16.520465-08:00", "updated_at": "2025-11-16T14:51:16.520465-08:00"}
{"id": "bd-0fvq", "title": "bd doctor should recommend bd prime migration for existing repos", "description": "bd doctor should detect old beads integration patterns and recommend migrating to bd prime approach.\n\n## Current behavior\n- bd doctor checks if Claude hooks are installed globally\n- Doesn't check project-level integration (AGENTS.md, CLAUDE.md)\n- Doesn't recommend migration for repos using old patterns\n\n## Desired behavior\nbd doctor should detect and suggest:\n\n1. **Old slash command pattern detected**\n   - Check for /beads:* references in AGENTS.md, CLAUDE.md\n   - Suggest: These slash commands are deprecated, use bd prime hooks instead\n   \n2. **No agent documentation**\n   - Check if AGENTS.md or CLAUDE.md exists\n   - Suggest: Run 'bd onboard' or 'bd setup claude' to document workflow\n   \n3. **Old MCP-only pattern**\n   - Check for instructions to use MCP tools but no bd prime hooks\n   - Suggest: Add bd prime hooks for better token efficiency\n\n4. **Migration path**\n   - Show: 'Run bd setup claude to add SessionStart/PreCompact hooks'\n   - Show: 'Update AGENTS.md to reference bd prime instead of slash commands'\n\n## Example output\n\nâš  Warning: Old beads integration detected in CLAUDE.md\n  Found: /beads:* slash command references (deprecated)\n  Recommend: Migrate to bd prime hooks for better token efficiency\n  Fix: Run 'bd setup claude' and update CLAUDE.md\n\nðŸ’¡ Tip: bd prime + hooks reduces token usage by 80-99% vs slash commands\n  MCP mode: ~50 tokens vs ~10.5k for full MCP scan\n  CLI mode: ~1-2k tokens with automatic context recovery\n\n## Benefits\n- Helps existing repos adopt new best practices\n- Clear migration path for users\n- Better token efficiency messaging", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-11-12T03:20:25.567748-08:00", "updated_at": "2025-11-12T03:20:25.567748-08:00"}
{"id": "bd-0yzm", "title": "GH#508: Orphan detection false positive when directory name contains dot", "description": "Directory names with dots trigger orphan issue detection because dot is also used for orphan ID format. bd rename-prefix fixes it. See: https://github.com/steveyegge/beads/issues/508", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:32:01.725196-08:00", "updated_at": "2025-12-14T16:52:49.802533-08:00"}
{"id": "bd-28db", "title": "Add 'bd status' command for issue database overview", "description": "Implement a bd status command that provides a quick snapshot of the issue database state, similar to how git status shows working tree state.\n\nExpected output: Show summary including counts by state (open, in-progress, blocked, closed), recent activity (last 7 days), and quick overview without needing multiple queries.\n\nExample output showing issue counts, recent activity stats, and pointer to bd list for details.\n\nProposed options: --all (show all issues), --assigned (show issues assigned to current user), --json (JSON format output)\n\nUse cases: Quick project health check, onboarding for new contributors, integration with shell prompts or CI/CD, daily standup reference", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-11-02T17:25:59.203549-08:00", "updated_at": "2025-11-02T17:25:59.203549-08:00"}
{"id": "bd-2k5f", "title": "GH#510: Document sync-branch worktree behavior", "description": "User confused about beads creating worktree on main branch. Need docs explaining sync-branch worktree mechanism. See: https://github.com/steveyegge/beads/issues/510", "status": "in_progress", "priority": 3, "issue_type": "task", "created_at": "2025-12-14T16:31:58.800071-08:00", "updated_at": "2025-12-14T16:52:49.802181-08:00"}
{"id": "bd-2q6d", "title": "Beads commands operate on stale database without warning", "description": "All beads read operations should validate database is in sync with JSONL before proceeding.\n\n**Current Behavior:**\n- Commands can query/read from stale database\n- Only mutation operations (like 'bd sync') check if JSONL is newer\n- User gets incorrect results without realizing database is out of sync\n\n**Expected Behavior:**\n- All beads commands should have pre-flight check for database freshness\n- If JSONL is newer than database, refuse to operate with error: \"Database out of sync. Run 'bd import' first.\"\n- Same safety check that exists for 'bd sync' should apply to ALL operations\n\n**Impact:**\n- Users make decisions based on incomplete/outdated data\n- Silent failures lead to confusion (e.g., thinking issues don't exist when they do)\n- Similar to running git commands on stale repo without being warned to pull\n\n**Example:**\n- Searched for bd-g9eu issue file: not found\n- Issue exists in .beads/issues.jsonl (in git)\n- Database was stale, but no warning was given\n- Led to incorrect conclusion that issue was already closed/deleted", "notes": "## Implementation Complete\n\n**Phase 1: Created staleness check (cmd/bd/staleness.go)**\n- ensureDatabaseFresh() function checks JSONL mtime vs last_import_time\n- Returns error with helpful message when database is stale\n- Auto-skips in daemon mode (daemon has auto-import)\n\n**Phase 2: Added to all read commands**\n- list, show, ready, status, stale, info, duplicates, validate\n- Check runs before database queries in direct mode\n- Daemon mode already protected via checkAndAutoImportIfStale()\n\n**Phase 3: Code Review Findings**\nSee follow-up issues:\n- bd-XXXX: Add warning when staleness check errors\n- bd-YYYY: Improve CheckStaleness error handling\n- bd-ZZZZ: Refactor redundant daemon checks (low priority)\n\n**Testing:**\n- Build successful: go build ./cmd/bd\n- Binary works: ./bd --version\n- Ready for manual testing\n\n**Next Steps:**\n1. Test with stale database scenario\n2. Implement review improvements\n3. Close issue when tests pass", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-11-20T19:33:40.019297-05:00", "updated_at": "2025-11-22T14:57:44.481917204-05:00"}
{"id": "bd-2rfr", "title": "GH#505: Add bd reset command to wipe database", "description": "Users struggle to fully reset beads (local + remote). Need bd reset command with safety confirmation. Currently requires manual hook/dir removal. See: https://github.com/steveyegge/beads/issues/505", "status": "in_progress", "priority": 2, "issue_type": "feature", "created_at": "2025-12-14T16:32:02.919494-08:00", "updated_at": "2025-12-14T16:52:49.799898-08:00"}
{"id": "bd-379", "title": "Implement `bd setup cursor` for Cursor IDE integration", "description": "Create a `bd setup cursor` command that integrates Beads workflow into Cursor IDE via .cursorrules file. Unlike Claude Code (which has hooks), Cursor uses a static rules file to provide context to its AI.", "status": "open", "priority": 3, "issue_type": "feature", "created_at": "2025-11-11T23:32:22.170083-08:00", "updated_at": "2025-11-11T23:32:22.170083-08:00"}
{"id": "bd-3852", "title": "Add orphan detection migration", "description": "Create migration to detect orphaned children in existing databases. Query: SELECT id FROM issues WHERE id LIKE '%.%' AND substr(id, 1, instr(id || '.', '.') - 1) NOT IN (SELECT id FROM issues). Log results, let user decide action (delete orphans or convert to top-level).", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-11-04T12:32:30.727044-08:00", "updated_at": "2025-11-04T12:32:30.727044-08:00"}
{"id": "bd-3sz0", "title": "Auto-repair stale merge driver configs with invalid placeholders", "description": "Old bd versions (<0.24.0) installed merge driver with invalid placeholders %L %R instead of %A %B. Add detection to bd doctor --fix: check if git config merge.beads.driver contains %L or %R, auto-repair to 'bd merge %A %O %A %B'. One-time migration for users who initialized with old versions.", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-11-21T23:16:10.762808-08:00", "updated_at": "2025-11-21T23:16:28.892655-08:00", "dependencies": [{"issue_id": "bd-3sz0", "depends_on_id": "bd-tbz3", "type": "parent-child", "created_at": "2025-11-21T23:16:10.763612-08:00", "created_by": "daemon"}]}
{"id": "bd-411u", "title": "Document BEADS_DIR pattern for multi-agent workspaces (Gas Town)", "description": "Gas Town and similar multi-agent systems need to configure separate beads databases per workspace/rig, distinct from any project-level beads.\n\n## Use Case\n\nIn Gas Town:\n- Each 'rig' (managed project) has multiple agents (polecats, refinery, witness)\n- All agents in a rig should share a single beads database at the rig level\n- This should be separate from any .beads/ the project itself uses\n- The BEADS_DIR env var enables this\n\n## Documentation Needed\n\n1. Add a section to docs explaining BEADS_DIR for multi-agent setups\n2. Example: setting BEADS_DIR in agent startup scripts/hooks\n3. Clarify interaction with project-level .beads/ (BEADS_DIR takes precedence)\n\n## Current Support\n\nAlready implemented in internal/beads/beads.go:FindDatabasePath():\n- BEADS_DIR env var is checked first (preferred)\n- BEADS_DB env var still supported (deprecated)\n- Falls back to .beads/ search in tree\n\nJust needs documentation for the multi-agent workspace pattern.", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-12-15T22:08:22.158027-08:00", "updated_at": "2025-12-15T22:08:22.158027-08:00"}
{"id": "bd-49kw", "title": "Workaround for FastMCP outputSchema bug in Claude Code", "description": "The beads MCP server (v0.23.1) successfully connects to Claude Code, but all tools fail to load with a schema validation error due to a bug in FastMCP 2.13.1.\n\nError: \"Invalid literal value, expected \\\"object\\\"\" in outputSchema.\n\nRoot Cause: FastMCP generates outputSchema with $ref at root level without \"type\": \"object\" for self-referential models (Issue).\n\nWorkaround: Use slash commands (/beads:ready) or wait for FastMCP fix.\n", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-11-20T18:55:39.041831-05:00", "updated_at": "2025-11-20T18:55:39.041831-05:00"}
{"id": "bd-4ec8", "title": "Widespread double JSON encoding bug in daemon mode RPC calls", "description": "Multiple CLI commands had the same double JSON encoding bug found in bd-1048. All commands that called ResolveID via RPC used string(resp.Data) instead of properly unmarshaling the JSON response. This caused IDs to retain JSON quotes (\"bd-1048\" instead of bd-1048), which then got double-encoded when passed to subsequent RPC calls.\n\nAffected commands:\n- bd show (3 instances)\n- bd dep add/remove/tree (5 instances)\n- bd label add/remove/list (3 instances)\n- bd reopen (1 instance)\n\nRoot cause: resp.Data is json.RawMessage (already JSON-encoded), so string() conversion preserves quotes.\n\nFix: Replace all string(resp.Data) with json.Unmarshal(resp.Data, &id) for proper deserialization.\n\nAll commands now tested and working correctly with daemon mode.", "status": "open", "priority": 0, "issue_type": "bug", "created_at": "2025-11-02T22:33:01.632691-08:00", "updated_at": "2025-11-02T22:33:01.632691-08:00"}
{"id": "bd-4q8", "title": "bd cleanup --hard should skip tombstone creation for true permanent deletion", "description": "## Problem\n\nWhen using bd cleanup --hard --older-than N --force, the command:\n1. Deletes closed issues older than N days (converting them to tombstones with NOW timestamp)\n2. Then tries to prune tombstones older than N days (finds none because they were just created)\n\nThis leaves the database bloated with fresh tombstones that will not be pruned.\n\n## Expected Behavior\n\nIn --hard mode, the deletion should be permanent without creating tombstones, since the user explicitly requested bypassing sync safety.\n\n## Workaround\n\nManually delete from database: sqlite3 .beads/beads.db 'DELETE FROM issues WHERE status=tombstone'\n\n## Fix Options\n\n1. In --hard mode, use a different delete path that does not create tombstones\n2. After deleting, immediately prune the just-created tombstones regardless of age\n3. Pass a skip_tombstone flag to the delete operation\n\nOption 1 is cleanest - --hard should mean permanent delete without tombstone.", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-12-16T01:33:36.580657-08:00", "updated_at": "2025-12-16T01:33:36.580657-08:00"}
{"id": "bd-4ri", "title": "Fix TestFallbackToDirectModeEnablesFlush deadlock causing 10min test timeout", "description": "## Problem\n\nTestFallbackToDirectModeEnablesFlush in direct_mode_test.go deadlocks for 9m59s before timing out, causing the entire test suite to take 10+ minutes instead of <10 seconds.\n\n## Root Cause\n\nDatabase lock contention between test cleanup and flushToJSONL():\n- Test cleanup (line 36) tries to close DB via defer\n- flushToJSONL() (line 132) is still accessing DB\n- Results in deadlock: database/sql.(*DB).Close() waits for mutex while GetJSONLFileHash() holds it\n\n## Stack Trace Evidence\n\n```\ngoroutine 512 [sync.Mutex.Lock, 9 minutes]:\ndatabase/sql.(*DB).Close(0x14000643790)\n  .../database/sql/sql.go:927 +0x84\ngithub.com/steveyegge/beads/cmd/bd.TestFallbackToDirectModeEnablesFlush.func1()\n  .../direct_mode_test.go:36 +0xf4\n\nWhile goroutine running flushToJSONL() holds DB connection via GetJSONLFileHash()\n```\n\n## Impact\n\n- Test suite: 10+ minutes â†’ should be <10 seconds\n- ALL other tests pass in ~4 seconds\n- This ONE test accounts for 99.9% of test runtime\n\n## Related\n\nThis is the EXACT same issue documented in MAIN_TEST_REFACTOR_NOTES.md for why main_test.go refactoring was deferred - global state manipulation + DB cleanup = deadlock.\n\n## Fix Approaches\n\n1. **Add proper cleanup sequencing** - stop flush goroutines BEFORE closing DB\n2. **Use test-specific DB lifecycle** - ensure flush completes before cleanup\n3. **Mock the flush mechanism** - avoid real DB for testing this code path  \n4. **Add explicit timeout handling** - fail fast with clear error instead of hanging\n\n## Files\n\n- cmd/bd/direct_mode_test.go:36-132\n- cmd/bd/autoflush.go:353 (validateJSONLIntegrity)\n- cmd/bd/autoflush.go:508 (flushToJSONLWithState)\n\n## Acceptance\n\n- Test passes without timeout\n- Test suite completes in <10 seconds\n- No deadlock between cleanup and flush operations", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-11-21T20:09:00.794372-05:00", "updated_at": "2025-11-21T20:09:00.794372-05:00"}
{"id": "bd-4uoc", "title": "Code Review Followup Summary: PR #481 + PR #551", "description": "## Merged PRs Summary\n\n### PR #551: Persist close_reason to issues table\n- âœ… Merged successfully\n- âœ… Bug fix: close_reason now persisted in database column (not just events table)\n- âœ… Comprehensive test coverage added\n- âœ… Handles reopen case (clearing close_reason)\n\n**Followup Issues Filed:**\n- bd-lxzx: Document close_reason in JSONL export format\n- bd-077e: Update CLI documentation for close_reason field\n\n---\n\n### PR #481: Context Engineering Optimizations (80-90% context reduction)\n- âœ… Merged successfully  \n- âœ… Lazy tool discovery: discover_tools() + get_tool_info()\n- âœ… Minimal issue models: IssueMinimal (~80% smaller than full Issue)\n- âœ… Result compaction: Auto-compacts results >20 items\n- âœ… All 28 tests passing\n- âš ï¸ Breaking change: ready() and list() return type changed\n\n**Followup Issues Filed:**\n- bd-b318: Add integration tests for CompactedResult\n- bd-4u2b: Make compaction settings configurable (THRESHOLD, PREVIEW_COUNT)\n- bd-2kf8: Document CompactedResult response format in CONTEXT_ENGINEERING.md\n- bd-pdr2: Document backwards compatibility considerations\n\n---\n\n## Overall Assessment\n\nBoth PRs are production-ready with solid implementations. All critical functionality works and tests pass. Followup issues focus on:\n1. Documentation improvements (5 issues)\n2. Integration test coverage (1 issue)\n3. Configuration flexibility (1 issue)\n4. Backwards compatibility guidance (1 issue)\n\nNo critical bugs or design issues found.\n\n## Review Completed By\nCode review process completed. Issues auto-created for tracking improvements.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T14:25:59.214886-08:00", "updated_at": "2025-12-14T14:25:59.214886-08:00", "dependencies": [{"issue_id": "bd-4uoc", "depends_on_id": "bd-otf4", "type": "discovered-from", "created_at": "2025-12-14T14:25:59.216884-08:00", "created_by": "stevey"}, {"issue_id": "bd-4uoc", "depends_on_id": "bd-z86n", "type": "discovered-from", "created_at": "2025-12-14T14:25:59.217296-08:00", "created_by": "stevey"}]}
{"id": "bd-581b80b3", "title": "bd find-duplicates - AI-powered duplicate detection", "description": "Find semantically duplicate issues.\n\nApproaches:\n1. Mechanical: Exact title/description matching\n2. Embeddings: Cosine similarity (cheap, scalable)\n3. AI: LLM-based semantic comparison (expensive, accurate)\n\nUses embeddings by default for >100 issues.\n\nFiles: cmd/bd/find_duplicates.go (new)", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-10-29T20:49:49.126801-07:00", "updated_at": "2025-10-30T17:12:58.218673-07:00"}
{"id": "bd-5b6e", "title": "Add tests for helper functions (GetDirtyIssueHash, GetAllDependencyRecords, export hashes)", "description": "Several utility functions have 0% coverage:\n- GetDirtyIssueHash (dirty.go)\n- GetAllDependencyRecords (dependencies.go)\n- GetExportHash, SetExportHash, ClearAllExportHashes (hash.go)\n\nThese are lower priority but should have basic coverage.", "status": "open", "priority": 4, "issue_type": "task", "created_at": "2025-11-01T22:40:58.989976-07:00", "updated_at": "2025-11-01T22:40:58.989976-07:00"}
{"id": "bd-5qim", "title": "Optimize GetReadyWork performance - 752ms on 10K database (target: <50ms)", "description": "", "notes": "# Performance Analysis (10K Issue Database)\n\nAnalyzed using CPU profiles from benchmark suite on Apple M2 Pro.\n\n## Operation Performance\n\n| Operation                        | Time    | Allocations | Memory |\n|----------------------------------|---------|-------------|--------|\n| bd ready (GetReadyWork)          | ~752ms  | 167,466     | 16MB   |\n| bd list (SearchIssues no filter) | ~11.6ms | 89,214      | 5.8MB  |\n| bd list (SearchIssues filtered)  | ~9.2ms  | 62,365      | 3.5MB  |\n| bd create (CreateIssue)          | ~2.6ms  | 146         | 8.6KB  |\n| bd update (UpdateIssue)          | ~0.32ms | 364         | 15KB   |\n| bd close (UpdateIssue)           | ~0.32ms | 364         | 15KB   |\n\n**Target: <50ms for all operations on 10K database**\n\n**Current issue: GetReadyWork is 15x over target (752ms vs 50ms)**\n\n## Root Cause\n\nGetReadyWork (internal/storage/sqlite/ready.go:90-128) uses recursive CTE to propagate blocking:\n- 65x slower than SearchIssues\n- Recalculates entire blocked issue tree on every call\n- Algorithm:\n  1. Find directly blocked issues via 'blocks' dependencies\n  2. Recursively propagate blockage to descendants (max depth: 50)\n  3. Exclude all blocked issues from results\n\n## CPU Profile Analysis\n\n- Database syscalls (pthread_cond_signal, syscall6): ~75%\n- SQLite engine overhead: inherent to recursive CTE\n- Application code (query construction): <1%\n\n**Bottleneck is the recursive CTE query execution, not application code.**\n\n## Optimization Recommendations\n\n### High Impact (Likely to achieve <50ms target)\n\n1. **Cache blocked issue calculation**\n   - Add `blocked_issues` table updated on dependency changes\n   - Trade write complexity for read speed (ready called >> dependency changes)\n   - Eliminates recursive CTE on every read\n\n2. **Add/verify database indexes**\n   ```sql\n   CREATE INDEX IF NOT EXISTS idx_dependencies_blocked \n     ON dependencies(issue_id, type, depends_on_id);\n   CREATE INDEX IF NOT EXISTS idx_issues_status \n     ON issues(status);\n   ```\n\n### Medium Impact\n\n3. **Reduce allocations** (167K allocations for GetReadyWork)\n   - Profile `scanIssues()` for object pooling opportunities\n   - Reuse slice capacity for repeated calls\n\n### Low Impact (Not recommended)\n- Query optimization for CRUD operations (already <3ms)\n- Connection pooling tuning (not showing in profiles)\n\n## Verification\n\nRun benchmarks to validate optimization:\n```bash\nmake bench-quick\ngo tool pprof -http=:8080 internal/storage/sqlite/bench-cpu-*.prof\n```\n\nProfile files automatically generated in `internal/storage/sqlite/`.", "status": "open", "priority": 0, "issue_type": "bug", "created_at": "2025-11-14T09:02:46.507526-08:00", "updated_at": "2025-11-14T09:03:44.073236-08:00"}
{"id": "bd-6pni", "title": "bd doctor --fix should auto-fix prefix mismatch errors", "description": "When bd doctor --fix encounters a prefix mismatch during DB-JSONL sync fix, it fails without offering to use --rename-on-import.\n\n**Current behavior:**\n```\nFixing DB-JSONL Sync...\nâ†’ Importing from JSONL...\nError importing: import failed: exit status 1\nImport failed: prefix mismatch detected: database uses 'bd-' but found issues with prefixes: [beads- (2 issues) test- (10 issues)]\n```\n\n**Expected behavior:**\n- Detect that the mismatched prefixes are all tombstones\n- Auto-apply --rename-on-import since tombstones with wrong prefixes are pollution\n- Or prompt: 'Found 21 issues with wrong prefixes (all tombstones). Remove them? [Y/n]'\n\n**Context:** Prefix pollution typically comes from contributor PRs that used different test prefixes. These are always safe to remove when they're tombstones.", "status": "closed", "priority": 2, "issue_type": "feature", "created_at": "2025-12-15T17:28:45.508654-08:00", "updated_at": "2025-12-16T00:54:56.458264-08:00", "closed_at": "2025-12-16T00:54:56.458264-08:00", "close_reason": "Fixed: See commit for details"}
{"id": "bd-6rl", "title": "Merge3Way public API does not expose TTL parameter", "description": "The public Merge3Way() function in merge.go does not allow callers to configure the tombstone TTL. It hard-codes the default via merge3WayWithTTL(). While merge3WayWithTTL() exists, it is unexported (lowercase). This means the CLI and tests cannot configure TTL at merge time. Use cases: testing with different TTL values, per-repository TTL configuration, debugging with short TTL, supporting --ttl flag in bd merge command (mentioned in design doc bd-zvg). Recommendation: Export Merge3WayWithTTL (rename to uppercase). Files: internal/merge/merge.go:77, 292-298", "status": "open", "priority": 3, "issue_type": "feature", "created_at": "2025-12-05T16:36:15.756814-08:00", "updated_at": "2025-12-05T16:36:15.756814-08:00"}
{"id": "bd-6sm6", "title": "Improve test coverage for internal/export (37.1% â†’ 60%)", "description": "The export package has only 37.1% test coverage. Export functionality needs good coverage to ensure data integrity.\n\nCurrent coverage: 37.1%\nTarget coverage: 60%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:06.802277-08:00", "updated_at": "2025-12-13T21:01:19.08088-08:00"}
{"id": "bd-6xfz", "title": "GH#517: Fix Claude setting wrong priority syntax on new install", "description": "Claude uses 'medium' instead of P2/2 for priority, causing infinite error loops. bd prime hook or docs not clear enough. See: https://github.com/steveyegge/beads/issues/517", "status": "in_progress", "priority": 1, "issue_type": "bug", "created_at": "2025-12-14T16:31:55.740197-08:00", "updated_at": "2025-12-14T16:52:49.795747-08:00"}
{"id": "bd-77gm", "title": "Import reports misleading '0 created, 0 updated' when actually importing all issues", "description": "When running 'bd import' on a fresh database (no existing issues), the command reports 'Import complete: 0 created, 0 updated' even though it successfully imported all issues from the JSONL file.\n\n**Steps to reproduce:**\n1. Delete .beads/beads.db\n2. Run: bd import .beads/issues.jsonl\n3. Observe output: 'Import complete: 0 created, 0 updated'\n4. Run: bd list\n5. Confirm: All issues are actually present in the database\n\n**Expected behavior:**\nReport the actual number of issues imported, e.g., 'Import complete: 523 created, 0 updated'\n\n**Actual behavior:**\n'Import complete: 0 created, 0 updated' (misleading - makes user think import failed)\n\n**Impact:**\n- Users think import failed when it succeeded\n- Confusing during database sync operations (e.g., after git pull)\n- Makes debugging harder (can't tell if import actually worked)\n\n**Context:**\nDiscovered during VC session when syncing database after git pull. The misleading message caused confusion about whether the database was properly synced with the canonical JSONL file.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-11-09T16:20:13.191156-08:00", "updated_at": "2025-11-09T16:20:13.191156-08:00"}
{"id": "bd-7m16", "title": "GH#519: bd sync fails when sync.branch is currently checked-out branch", "description": "bd sync tries to create worktree for sync.branch even when already on that branch. Should commit directly instead. See GitHub issue #519.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:36.613211-08:00", "updated_at": "2025-12-16T01:03:36.613211-08:00"}
{"id": "bd-7r4l", "title": "GH#488: Support claude.local.md for local-only config", "description": "Allow CLAUDE.local.md for testing bd without committing to repo or overriding shared CLAUDE.md. Not every repo wants committed AI config. See: https://github.com/steveyegge/beads/issues/488", "status": "in_progress", "priority": 2, "issue_type": "feature", "created_at": "2025-12-14T16:32:19.944847-08:00", "updated_at": "2025-12-14T16:52:49.800832-08:00"}
{"id": "bd-7yg", "title": "Git merge driver uses invalid placeholders (%L, %R instead of %A, %B)", "description": "## Problem\n\nThe beads git merge driver is configured with invalid Git placeholders:\n\n```\ngit config merge.beads.driver \"bd merge %A %O %L %R\"\n```\n\nGit doesn't recognize `%L` or `%R` as valid merge driver placeholders. The valid placeholders are:\n- `%O` = base (common ancestor)\n- `%A` = current version (ours)\n- `%B` = other version (theirs)\n\n## Impact\n\n- Affects ALL users when they have `.beads/beads.jsonl` merge conflicts\n- Automatic JSONL merge fails with error: \"error reading left file: failed to open file: open 7: no such file or directory\"\n- Users must manually resolve conflicts instead of getting automatic merge\n\n## Root Cause\n\nThe `bd init` command (or wherever the merge driver is configured) is using non-standard placeholders. When Git encounters `%L` and `%R`, it either passes them literally or interprets them incorrectly.\n\n## Fix\n\nUpdate the merge driver configuration to:\n```\ngit config merge.beads.driver \"bd merge %A %O %A %B\"\n```\n\nWhere:\n- 1st `%A` = output file (current file, will be overwritten)\n- `%O` = base (common ancestor)\n- 2nd `%A` = left/current version\n- `%B` = right/other version\n\n## Action Items\n\n1. Fix `bd init` (or equivalent setup command) to use correct placeholders\n2. Add migration/warning for existing users with misconfigured merge driver\n3. Update documentation with correct merge driver setup\n4. Consider adding validation when `bd init` is run", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-11-21T19:51:55.747608-05:00", "updated_at": "2025-11-21T19:51:55.747608-05:00"}
{"id": "bd-83xx", "title": "bd cleanup fails with CHECK constraint on status/closed_at mismatch", "description": "## Problem\n\nRunning `bd cleanup --force` fails with:\n\n```\nError: failed to create tombstone for bd-okh: sqlite3: constraint failed: CHECK constraint failed: (status = 'closed') = (closed_at IS NOT NULL)\n```\n\n## Root Cause\n\nThe database has a CHECK constraint ensuring closed issues have `closed_at` set and non-closed issues don't. When `bd cleanup` tries to convert a closed issue to a tombstone, this constraint fails if:\n1. The issue has status='closed' but closed_at is NULL, OR\n2. The issue is being converted but the tombstone creation doesn't properly handle the closed_at field\n\n## Impact\n\n- `bd cleanup --force` cannot complete\n- 722 closed issues cannot be cleaned up\n- Blocks routine maintenance\n\n## Investigation Needed\n\n1. Check the bd-okh record in the database:\n   ```sql\n   SELECT id, status, closed_at, deleted_at FROM issues WHERE id = 'bd-okh';\n   ```\n2. Determine if this is data corruption or a bug in tombstone creation\n\n## Proposed Solutions\n\n1. **If data corruption**: Add a `bd doctor --fix` check that repairs status/closed_at mismatches\n2. **If code bug**: Fix the tombstone creation to properly handle the constraint\n\n## Files to Investigate\n\n- `internal/storage/sqlite/sqlite.go` - DeleteIssue / tombstone creation\n- Schema CHECK constraint definition\n\n## Acceptance Criteria\n\n- [ ] Identify root cause (data vs code bug)\n- [ ] `bd cleanup --force` completes successfully\n- [ ] `bd doctor` detects status/closed_at mismatches", "status": "closed", "priority": 1, "issue_type": "bug", "created_at": "2025-12-13T23:49:54.012806-08:00", "updated_at": "2025-12-16T02:19:57.236953-08:00", "closed_at": "2025-12-14T17:30:05.427749-08:00"}
{"id": "bd-8v5o", "title": "bd doctor --fix hydrates issues that remain in deletions manifest, causing perpetual skip warnings", "description": "When bd doctor --fix hydrates issues from git history, it doesn't remove them from the deletions manifest. This causes a conflict where:\n1. Issue exists in database as 'open'\n2. Issue also exists in deletions manifest\n3. Every sync reports 'Skipping bd-xxx (in deletions manifest)'\n4. Issue is 'Protected from incorrect sanitization'\n\n**Reproduction:**\n1. Run bd doctor --fix (which hydrates issues from git history)\n2. Run bd sync\n3. Observe conflicting messages about protected issues being skipped\n\n**Affected issues in this session:**\nbd-eyto, bd-6rl, bd-y2v, bd-abjw, bd-a0cp, bd-mql4, bd-nl2\n\n**Expected behavior:**\nWhen hydrating an issue, also remove it from the deletions manifest to prevent conflict.\n\n**Workaround:** Manually remove conflicting IDs from deletions.jsonl", "status": "closed", "priority": 1, "issue_type": "bug", "created_at": "2025-12-15T17:28:40.060713-08:00", "updated_at": "2025-12-16T00:41:33.165408-08:00", "closed_at": "2025-12-16T00:41:33.165408-08:00", "close_reason": "Fixed: doctor --fix now removes hydrated issues from deletions manifest; sync now shows summary instead of per-issue skip messages"}
{"id": "bd-90v", "title": "bd prime: AI context loading and Claude Code integration", "description": "Implement `bd prime` command and Claude Code hooks for context recovery. Hooks work with BOTH MCP server and CLI approaches - they solve the context memory problem (keeping bd workflow fresh after compaction) not the tool access problem (MCP vs CLI).", "status": "open", "priority": 2, "issue_type": "epic", "created_at": "2025-11-11T23:31:12.119012-08:00", "updated_at": "2025-11-12T00:11:07.743189-08:00"}
{"id": "bd-9cdc", "title": "Update docs for import bug fix", "description": "Update AGENTS.md, README.md, TROUBLESHOOTING.md with import.orphan_handling config documentation. Document resurrection behavior, tombstones, config modes. Add troubleshooting section for import failures with deleted parents.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-11-04T12:32:30.770415-08:00", "updated_at": "2025-11-04T12:32:30.770415-08:00"}
{"id": "bd-a0cp", "title": "Consider using types.Status in merge package for type safety", "description": "The merge package uses string for status comparison (e.g., result.Status == closed, issue.Status == StatusTombstone). The types package defines Status as a type alias with validation. While the merge package needs its own Issue struct for JSONL flexibility, it could import and use types.Status for constants to get compile-time type checking. Current code: if left == closed || right == closed. Could be: if left == string(types.StatusClosed). This is low priority since string comparison works correctly. Files: internal/merge/merge.go:44, 488, 501-521", "status": "open", "priority": 4, "issue_type": "task", "created_at": "2025-12-05T16:37:10.690424-08:00", "updated_at": "2025-12-05T16:37:10.690424-08:00"}
{"id": "bd-a15d", "title": "Add test files for internal/storage", "description": "The internal/storage package has no test files at all. This package provides the storage interface abstraction.\n\nCurrent coverage: N/A (no test files)\nTarget: Add basic interface tests", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:11.363017-08:00", "updated_at": "2025-12-13T21:01:20.925779-08:00"}
{"id": "bd-abjw", "title": "Consider consolidating config.yaml parsing into shared utility", "description": "Multiple places parse config.yaml with custom structs:\n\n1. **autoimport.go:148** - `localConfig{SyncBranch}`\n2. **main.go:310** - strings.Contains for no-db (fragile, see bd-r6k2)\n3. **doctor.go:863** - strings.Contains for no-db (fragile, see bd-r6k2)\n4. **internal/config/config.go** - Uses viper (but caches at startup, problematic for tests)\n\nConsider creating a shared utility in `internal/configfile/` or extending the viper config:\n\n```go\n// internal/configfile/yaml.go\ntype YAMLConfig struct {\n    SyncBranch string `yaml:\"sync-branch\"`\n    NoDb       bool   `yaml:\"no-db\"`\n    IssuePrefix string `yaml:\"issue-prefix\"`\n    Author     string `yaml:\"author\"`\n}\n\nfunc LoadYAML(beadsDir string) (*YAMLConfig, error) {\n    // Parse config.yaml with proper YAML library\n}\n```\n\nBenefits:\n- Single source of truth for config.yaml structure\n- Proper YAML parsing everywhere\n- Easier to add new config fields\n\nTrade-off: May add complexity for simple one-off reads.", "status": "open", "priority": 4, "issue_type": "task", "created_at": "2025-12-07T02:03:26.067311-08:00", "updated_at": "2025-12-07T02:03:26.067311-08:00"}
{"id": "bd-admx", "title": "Perpetual 'JSONL file hash mismatch detected (bd-160)' warning", "description": "After cleanup operations, every bd command shows:\n```\nâš ï¸  WARNING: JSONL file hash mismatch detected (bd-160)\n  This indicates JSONL and export_hashes are out of sync.\n  Clearing export_hashes to force full re-export.\n```\n\nThe warning appears repeatedly even after the hash is supposedly cleared. This suggests either:\n1. The clear isn't persisting\n2. Something keeps causing the mismatch\n3. The detection logic has a bug\n\n**Impact:** Warning fatigue - users ignore it, may miss real issues.\n\n**Expected behavior:** After clearing export_hashes once, subsequent operations should not show the warning unless there's a new mismatch.", "status": "closed", "priority": 2, "issue_type": "bug", "created_at": "2025-12-15T17:28:56.361302-08:00", "updated_at": "2025-12-16T00:54:56.46055-08:00", "closed_at": "2025-12-16T00:54:56.46055-08:00", "close_reason": "Fixed: See commit for details"}
{"id": "bd-au0", "title": "Command Set Standardization & Flag Consistency", "description": "Comprehensive improvements to bd command set based on 2025 audit findings.\n\n## Background\nSee docs/command-audit-2025.md for detailed analysis.\n\n## Goals\n1. Standardize flag naming and behavior across all commands\n2. Add missing flags for feature parity\n3. Fix naming confusion\n4. Improve consistency in JSON output\n\n## Success Criteria\n- All mutating commands support --dry-run (no --preview variants)\n- bd update supports label operations\n- bd search has filter parity with bd list\n- Priority flags accept both int and P0-P4 format everywhere\n- JSON output is consistent across all commands", "status": "open", "priority": 2, "issue_type": "epic", "created_at": "2025-11-21T21:05:55.672749-05:00", "updated_at": "2025-11-21T21:05:55.672749-05:00"}
{"id": "bd-au0.10", "title": "Add global verbosity flags (--verbose, --quiet)", "description": "Add consistent verbosity controls across all commands.\n\n**Current state:**\n- bd init has --quiet flag\n- No other commands have verbosity controls\n- Debug output controlled by BD_VERBOSE env var\n\n**Proposal:**\nAdd persistent flags:\n- --verbose / -v: Enable debug output\n- --quiet / -q: Suppress non-essential output\n\n**Implementation:**\n- Add to rootCmd.PersistentFlags()\n- Replace BD_VERBOSE checks with flag checks\n- Standardize output levels:\n  * Quiet: Errors only\n  * Normal: Errors + success messages\n  * Verbose: Errors + success + debug info\n\n**Files to modify:**\n- cmd/bd/main.go (add flags)\n- internal/debug/debug.go (respect flags)\n- Update all commands to respect quiet mode\n\n**Testing:**\n- Verify --verbose shows debug output\n- Verify --quiet suppresses normal output\n- Ensure errors always show regardless of mode", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-11-21T21:08:21.600209-05:00", "updated_at": "2025-11-21T21:08:21.600209-05:00", "dependencies": [{"issue_id": "bd-au0.10", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:08:21.602557-05:00", "created_by": "daemon"}]}
{"id": "bd-au0.5", "title": "Add date and priority filters to bd search", "description": "Add filter parity with bd list for consistent querying.\n\n**Missing filters to add:**\n- --priority, --priority-min, --priority-max\n- --created-after, --created-before\n- --updated-after, --updated-before\n- --closed-after, --closed-before\n- --empty-description, --no-assignee, --no-labels\n- --desc-contains, --notes-contains\n\n**Files to modify:**\n- cmd/bd/search.go\n- internal/rpc/protocol.go (SearchArgs)\n- internal/storage/storage.go (Search method)\n\n**Testing:**\n- All filter combinations\n- Date format parsing\n- Daemon and direct mode", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-11-21T21:07:05.496726-05:00", "updated_at": "2025-11-21T21:07:05.496726-05:00", "dependencies": [{"issue_id": "bd-au0.5", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:07:05.497762-05:00", "created_by": "daemon"}]}
{"id": "bd-au0.6", "title": "Add comprehensive filters to bd export", "description": "Enhance bd export with filtering options for selective exports.\n\n**Currently only has:**\n- --status\n\n**Add filters:**\n- --label, --label-any\n- --assignee\n- --type\n- --priority, --priority-min, --priority-max\n- --created-after, --created-before\n- --updated-after, --updated-before\n\n**Use case:**\n- Export only open issues: bd export --status open\n- Export high-priority bugs: bd export --type bug --priority-max 1\n- Export recent issues: bd export --created-after 2025-01-01\n\n**Files to modify:**\n- cmd/bd/export.go\n- Reuse filter logic from list.go", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-11-21T21:07:19.431307-05:00", "updated_at": "2025-11-21T21:07:19.431307-05:00", "dependencies": [{"issue_id": "bd-au0.6", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:07:19.432983-05:00", "created_by": "daemon"}]}
{"id": "bd-au0.7", "title": "Audit and standardize JSON output across all commands", "description": "Ensure consistent JSON format and error handling when --json flag is used.\n\n**Scope:**\n1. Verify all commands respect --json flag\n2. Standardize success response format\n3. Standardize error response format\n4. Document JSON schemas\n\n**Commands to audit:**\n- Core CRUD: create, update, delete, show, list, search âœ“\n- Queries: ready, blocked, stale, count, stats, status\n- Deps: dep add/remove/tree/cycles\n- Labels: label commands\n- Comments: comments add/list/delete\n- Epics: epic status/close-eligible\n- Export/import: already support --json âœ“\n\n**Testing:**\n- Success cases return valid JSON\n- Error cases return valid JSON (not plain text)\n- Consistent field naming (snake_case vs camelCase)\n- Array vs object wrapping consistency", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-11-21T21:07:35.304424-05:00", "updated_at": "2025-11-21T21:07:35.304424-05:00", "dependencies": [{"issue_id": "bd-au0.7", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:07:35.305663-05:00", "created_by": "daemon"}]}
{"id": "bd-au0.8", "title": "Improve clean vs cleanup command naming/documentation", "description": "Clarify the difference between bd clean and bd cleanup to reduce user confusion.\n\n**Current state:**\n- bd clean: Remove temporary artifacts (.beads/bd.sock, logs, etc.)\n- bd cleanup: Delete old closed issues from database\n\n**Options:**\n1. Rename for clarity:\n   - bd clean â†’ bd clean-temp\n   - bd cleanup â†’ bd cleanup-issues\n   \n2. Keep names but improve help text and documentation\n\n3. Add prominent warnings in help output\n\n**Preferred approach:** Option 2 (improve documentation)\n- Update short/long descriptions in commands\n- Add examples to help text\n- Update README.md\n- Add cross-references in help output\n\n**Files to modify:**\n- cmd/bd/clean.go\n- cmd/bd/cleanup.go\n- README.md or ADVANCED.md", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-11-21T21:07:49.960534-05:00", "updated_at": "2025-11-21T21:07:49.960534-05:00", "dependencies": [{"issue_id": "bd-au0.8", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:07:49.962743-05:00", "created_by": "daemon"}]}
{"id": "bd-au0.9", "title": "Review and document rarely-used commands", "description": "Document use cases or consider deprecation for infrequently-used commands.\n\n**Commands to review:**\n1. bd rename-prefix - How often is this used? Document use cases\n2. bd detect-pollution - Consider integrating into bd validate\n3. bd migrate-hash-ids - One-time migration, keep but document as legacy\n\n**For each command:**\n- Document typical use cases\n- Add examples to help text\n- Consider if it should be a subcommand instead\n- Add deprecation warning if appropriate\n\n**Not changing:**\n- duplicates âœ“ (useful for data quality)\n- repair-deps âœ“ (useful for fixing broken refs)\n- restore âœ“ (critical for compacted issues)\n- compact âœ“ (performance feature)\n\n**Deliverable:**\n- Updated help text\n- Documentation in ADVANCED.md\n- Deprecation plan if needed", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-11-21T21:08:05.588275-05:00", "updated_at": "2025-11-21T21:08:05.588275-05:00", "dependencies": [{"issue_id": "bd-au0.9", "depends_on_id": "bd-au0", "type": "parent-child", "created_at": "2025-11-21T21:08:05.59003-05:00", "created_by": "daemon"}]}
{"id": "bd-bscs", "title": "GH#518: Document bd setup command", "description": "bd setup (e.g. bd setup cursor) is undocumented. Users only find it by grepping source. Need proper docs. See: https://github.com/steveyegge/beads/issues/518", "status": "in_progress", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T16:31:35.881408-08:00", "updated_at": "2025-12-14T16:52:49.796464-08:00"}
{"id": "bd-bwdd", "title": "GH#497: bd onboard copilot-instructions.md is beads-specific, not generic", "description": "bd onboard outputs beads repo specific content (Go/SQLite/Cobra) for copilot-instructions.md instead of a generic template. AGENTS.md output is correct. See: https://github.com/steveyegge/beads/issues/497", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:32:18.599655-08:00", "updated_at": "2025-12-14T16:52:49.794787-08:00"}
{"id": "bd-bwk2", "title": "Centralize error handling patterns in storage layer", "description": "80+ instances of inconsistent error handling across sqlite.go with mix of %w, %v, and no wrapping.\n\nLocation: internal/storage/sqlite/sqlite.go (throughout)\n\nProblem:\n- Some use fmt.Errorf(\"op failed: %w\", err) - correct wrapping\n- Some use fmt.Errorf(\"op failed: %v\", err) - loses error chain\n- Some return err directly - no context\n- Hard to debug production issues\n- Can't distinguish error types\n\nSolution: Create internal/storage/sqlite/errors.go:\n- Define sentinel errors (ErrNotFound, ErrInvalidID, etc.)\n- Create wrapDBError(op string, err error) helper\n- Convert sql.ErrNoRows to ErrNotFound\n- Always wrap with operation context\n\nImpact: Lost error context; inconsistent messages; hard to debug\n\nEffort: 5-7 hours", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-11-16T14:51:54.974909-08:00", "updated_at": "2025-11-16T14:51:54.974909-08:00"}
{"id": "bd-bxha", "title": "Default to YES for git hooks and merge driver installation", "description": "Currently bd init prompts user to install git hooks and merge driver, but setup is incomplete if user declines. Change to install by default unless --skip-hooks or --skip-merge-driver flags are passed. Better safe defaults. If installation fails, warn user and suggest bd doctor --fix.", "status": "open", "priority": 1, "issue_type": "feature", "created_at": "2025-11-21T23:16:10.172238-08:00", "updated_at": "2025-11-21T23:16:28.369137-08:00", "dependencies": [{"issue_id": "bd-bxha", "depends_on_id": "bd-tbz3", "type": "parent-child", "created_at": "2025-11-21T23:16:10.173034-08:00", "created_by": "daemon"}]}
{"id": "bd-cddj", "title": "GH#520: Daemon sync-branch commit fails with pre-commit hooks (needs --no-verify)", "description": "gitCommitInWorktree in daemon_sync_branch.go missing --no-verify flag, causing commit failures when pre-commit hooks installed. Library function in worktree.go:684 has correct impl. See: https://github.com/steveyegge/beads/issues/520", "status": "in_progress", "priority": 1, "issue_type": "bug", "created_at": "2025-12-14T16:31:33.151247-08:00", "updated_at": "2025-12-14T16:52:49.801315-08:00"}
{"id": "bd-crgr", "title": "GH#517: Claude sets priority wrong on new install", "description": "Claude uses 'medium/high/low' for priority instead of P0-P4. Update bd prime/onboard output to be clearer about priority syntax. See GitHub issue #517.", "status": "closed", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:34.803084-08:00", "updated_at": "2025-12-16T02:19:57.236226-08:00", "closed_at": "2025-12-16T01:08:56.214718-08:00"}
{"id": "bd-d148", "title": "GH#483: Pre-commit hook fails unnecessarily when .beads removed", "description": "Pre-commit hook fails on bd sync when .beads directory exists but user is on branch without beads. Should exit gracefully. See GitHub issue #483.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:40.049785-08:00", "updated_at": "2025-12-16T01:03:40.049785-08:00"}
{"id": "bd-dvw8", "title": "GH#523: Fix closed issues missing closed_at timestamp during db upgrade", "description": "Old beads databases may have closed issues without closed_at timestamps, causing 'closed issues must have closed_at timestamp' validation errors on upgrade to 0.29.0. Need defensive handling during import. See: https://github.com/steveyegge/beads/issues/523", "status": "in_progress", "priority": 1, "issue_type": "bug", "created_at": "2025-12-14T16:31:30.421555-08:00", "updated_at": "2025-12-14T16:52:49.796924-08:00"}
{"id": "bd-e0o7", "title": "Refactor: extract common helpers in sync-branch hook checks", "description": "Code review of #532 fix identified duplication between checkSyncBranchHookCompatibility and checkSyncBranchHookQuick.\n\nSuggested refactoring:\n1. Extract getPrePushHookPath(path string) helper for git dir + hook path resolution\n2. Extract extractHookVersion(hookContent string) helper for version parsing\n3. Consider whether Warning for custom hooks is appropriate (vs OK with info message)\n4. Document the intentional behavior difference between full check (Warning for custom) and quick check (OK for custom)", "status": "closed", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T18:04:04.220868-08:00", "updated_at": "2025-12-16T02:19:57.236602-08:00", "closed_at": "2025-12-14T17:36:22.147803-08:00"}
{"id": "bd-e1085716", "title": "bd validate - Comprehensive health check", "description": "Run all validation checks in one command.\n\nChecks:\n- Duplicates\n- Orphaned dependencies\n- Test pollution\n- Git conflicts\n\nSupports --fix-all for auto-repair.\n\nDepends on bd-cbed9619.1, bd-0dcea000, bd-31aab707, bd-9826b69a.\n\nFiles: cmd/bd/validate.go (new)", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-10-29T23:05:13.980679-07:00", "updated_at": "2025-10-30T17:12:58.19736-07:00"}
{"id": "bd-eeqf", "title": "GH#486: Claude forgets beads workflow mid-session", "description": "Claude progressively reverts to TodoWrite or skips tracking despite CLAUDE.md instructions. Happens after context resets or long sessions. Need stronger prompting or hooks. See: https://github.com/steveyegge/beads/issues/486", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:32:21.544338-08:00", "updated_at": "2025-12-14T16:52:49.797933-08:00"}
{"id": "bd-er7r", "title": "GH#509: bd fails to find .beads from nested worktrees", "description": "findDatabaseInTree stops at worktree git root, missing .beads in parent repo. Should check git-common-dir and search past worktree root. See: https://github.com/steveyegge/beads/issues/509", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:32:00.082813-08:00", "updated_at": "2025-12-14T16:52:49.8029-08:00"}
{"id": "bd-eyto", "title": "Time-dependent tests may be flaky near TTL boundary", "description": "Several tombstone merge tests use time.Now() to create test data: time.Now().Add(-24 * time.Hour), time.Now().Add(-60 * 24 * time.Hour), etc. While these work reliably in practice (24h vs 30d TTL has large margin), they could theoretically be flaky if: 1) Tests run slowly, 2) System clock changes during test, 3) TTL constants change. Recommendation: Consider using a fixed reference time or time injection for deterministic tests. Lower priority since current margin is large. Files: internal/merge/merge_test.go:1337-1338, 1352-1353, 1548-1549, 1590-1591", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-12-05T16:37:02.348143-08:00", "updated_at": "2025-12-05T16:37:02.348143-08:00"}
{"id": "bd-ffr9", "title": "deletions.jsonl recreated locally after tombstone migration", "description": "After running bd migrate-tombstones and removing deletions.jsonl from git, the file gets recreated locally on subsequent bd commands.\n\n**Steps to reproduce:**\n1. Run bd migrate-tombstones (converts to inline tombstones)\n2. Remove deletions.jsonl from git and filesystem\n3. Run bd sync or bd stats\n4. deletions.jsonl reappears\n\n**Expected behavior:**\nAfter migration, deletions.jsonl should not be recreated. All tombstone data should come from inline tombstones in issues.jsonl.\n\n**Workaround:** Add deletions.jsonl to .gitignore to prevent re-tracking. File still gets created but won't pollute the repo.", "status": "closed", "priority": 2, "issue_type": "bug", "created_at": "2025-12-15T17:28:50.949625-08:00", "updated_at": "2025-12-16T00:54:56.459227-08:00", "closed_at": "2025-12-16T00:54:56.459227-08:00", "close_reason": "Fixed: See commit for details"}
{"id": "bd-fx7v", "title": "Improve test coverage for cmd/bd/doctor/fix (23.9% â†’ 50%)", "description": "The doctor/fix package has only 23.9% test coverage. The doctor fix functionality is important for troubleshooting.\n\nCurrent coverage: 23.9%\nTarget coverage: 50%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:05.67127-08:00", "updated_at": "2025-12-13T21:01:20.839298-08:00"}
{"id": "bd-g9eu", "title": "Investigate TestRoutingIntegration failure", "description": "TestRoutingIntegration/maintainer_with_SSH_remote failed during pre-commit check with \"expected role maintainer, got contributor\".\nThis occurred while running `go test -short ./...` on darwin/arm64.\nThe failure appears unrelated to storage/sqlite changes.\nNeed to investigate if this is a flaky test or environmental issue.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-11-20T15:55:19.337094-08:00", "updated_at": "2025-11-20T15:55:19.337094-08:00"}
{"id": "bd-h5n1", "title": "bd cleanup should also prune expired tombstones", "description": "## Problem\n\n`bd cleanup` deletes closed issues (converting them to tombstones) but does NOT prune expired tombstones. Users expect 'cleanup' to do comprehensive cleanup.\n\n## Current Behavior\n\n1. `bd cleanup --force` â†’ converts closed issues to tombstones\n2. Expired tombstones (>30 days) remain in issues.jsonl\n3. User must separately run `bd compact` to prune tombstones\n4. `bd doctor` warns about expired tombstones: 'Run bd compact to prune'\n\n## Expected Behavior\n\n`bd cleanup` should also prune expired tombstones from issues.jsonl.\n\n## Impact\n\nWith v0.30.0 making tombstones the default migration path, this UX gap becomes more visible. Users cleaning up their database shouldn't need to know about a separate `bd compact` command.\n\n## Proposed Solution\n\nCall `pruneExpiredTombstones()` at the end of the cleanup command (same function used by compact). Report results:\n\n```\nâœ“ Deleted 15 closed issue(s)\nâœ“ Pruned 3 expired tombstone(s) (older than 30 days)\n```\n\n## Files to Modify\n\n- `cmd/bd/cleanup.go` - Add call to pruneExpiredTombstones after deleteBatch\n- May need to move pruneExpiredTombstones to shared location if not already accessible\n\n## Acceptance Criteria\n\n- [ ] `bd cleanup --force` prunes expired tombstones after deleting closed issues\n- [ ] `bd cleanup --dry-run` shows what tombstones would be pruned\n- [ ] JSON output includes tombstone prune results", "status": "closed", "priority": 1, "issue_type": "bug", "created_at": "2025-12-13T23:49:35.963356-08:00", "updated_at": "2025-12-16T02:19:57.237989-08:00", "closed_at": "2025-12-14T17:29:50.073906-08:00"}
{"id": "bd-hkr6", "title": "GH#518: Document bd setup command", "description": "bd setup is undiscoverable. Add to README/docs. Currently only findable by grepping source. See GitHub issue #518.", "status": "closed", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T01:03:54.664668-08:00", "updated_at": "2025-12-16T02:19:57.238358-08:00", "closed_at": "2025-12-16T01:09:56.734268-08:00"}
{"id": "bd-hlsw", "title": "Add sync resilience guardrails for forced pushes and prefix mismatches", "description": "Beads can get into unrecoverable sync states when remote forces pushes occur (e.g., rebases) combined with prefix mismatches from multi-worker scenarios. Add detection, prevention, and auto-recovery features to handle this gracefully.", "status": "open", "priority": 2, "issue_type": "epic", "created_at": "2025-12-14T10:40:14.872875259-07:00", "updated_at": "2025-12-14T10:40:14.872875259-07:00"}
{"id": "bd-hlsw.1", "title": "Pre-sync integrity check (bd sync --check)", "description": "Add bd sync --check flag that detects problematic states before attempting sync: forced pushes on sync branch (via git reflog), prefix mismatches in JSONL, orphaned children with missing parents. Output combined diagnostic without modifying state.", "status": "closed", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T10:40:20.493608412-07:00", "updated_at": "2025-12-16T02:19:57.23868-08:00", "closed_at": "2025-12-16T01:13:33.639724-08:00", "dependencies": [{"issue_id": "bd-hlsw.1", "depends_on_id": "bd-hlsw", "type": "parent-child", "created_at": "2025-12-14T10:40:20.494249154-07:00", "created_by": "daemon"}]}
{"id": "bd-hlsw.2", "title": "Improve sync error messages", "description": "When bd sync fails, immediately surface the actual root cause (prefix mismatch, orphaned children, forced push detected, etc.) instead of requiring multiple retries to discover it. Make errors actionable with specific recovery steps.", "status": "closed", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T10:40:20.545731796-07:00", "updated_at": "2025-12-16T02:19:57.237295-08:00", "closed_at": "2025-12-16T01:17:06.844571-08:00", "dependencies": [{"issue_id": "bd-hlsw.2", "depends_on_id": "bd-hlsw", "type": "parent-child", "created_at": "2025-12-14T10:40:20.546686125-07:00", "created_by": "daemon"}]}
{"id": "bd-hlsw.3", "title": "Auto-recovery mode (bd sync --auto-recover)", "description": "Add bd sync --auto-recover flag that: detects problematic sync state, backs up .beads/issues.db with timestamp, rebuilds DB from JSONL atomically, verifies consistency, reports what was fixed. Provides safety valve when sync integrity fails.", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-12-14T10:40:20.599836875-07:00", "updated_at": "2025-12-14T10:40:20.599836875-07:00", "dependencies": [{"issue_id": "bd-hlsw.3", "depends_on_id": "bd-hlsw", "type": "parent-child", "created_at": "2025-12-14T10:40:20.600435888-07:00", "created_by": "daemon"}]}
{"id": "bd-hlsw.4", "title": "Sync branch integrity guards", "description": "Track sync branch parent commit. If sync branch was force-pushed, warn user and require confirmation before proceeding. Add option to reset to remote if user accepts rebase. Prevents silent corruption from forced pushes.", "status": "open", "priority": 3, "issue_type": "task", "created_at": "2025-12-14T10:40:20.645402352-07:00", "updated_at": "2025-12-14T10:40:20.645402352-07:00", "dependencies": [{"issue_id": "bd-hlsw.4", "depends_on_id": "bd-hlsw", "type": "parent-child", "created_at": "2025-12-14T10:40:20.646425761-07:00", "created_by": "daemon"}]}
{"id": "bd-hnkg", "title": "GH#540: Add silent quick-capture mode (bd q)", "description": "Add bd q alias for quick capture that outputs only issue ID. Useful for piping/scripting. See GitHub issue #540.", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-12-16T01:03:38.260135-08:00", "updated_at": "2025-12-16T01:03:38.260135-08:00"}
{"id": "bd-hy9p", "title": "Add --body-file flag to bd create for reading descriptions from files", "description": "## Problem\n\nCreating issues with long/complex descriptions via CLI requires shell escaping gymnastics:\n\n```bash\n# Current workaround - awkward heredoc quoting\nbd create --title=\"...\" --description=\"$(cat <<'EOF'\n...markdown...\nEOF\n)\"\n\n# Often fails with quote escaping errors in eval context\n# Agents resort to writing temp files then reading them\n```\n\n## Proposed Solution\n\nAdd `--body-file` and `--description-file` flags to read description from a file, matching `gh` CLI pattern.\n\n```bash\n# Natural pattern that aligns with training data\ncat > /tmp/desc.md << 'EOF'\n...markdown content...\nEOF\n\nbd create --title=\"...\" --body-file=/tmp/desc.md\n```\n\n## Implementation\n\n### 1. Add new flags to `bd create`\n\n```go\ncreateCmd.Flags().String(\"body-file\", \"\", \"Read description from file (use - for stdin)\")\ncreateCmd.Flags().String(\"description-file\", \"\", \"Alias for --body-file\")\n```\n\n### 2. Flag precedence\n\n- If `--body-file` or `--description-file` is provided, read from file\n- If value is `-`, read from stdin\n- Otherwise fall back to `--body` or `--description` flag\n- If neither provided, description is empty (current behavior)\n\n### 3. Error handling\n\n- File doesn't exist â†’ clear error message\n- File not readable â†’ clear error message\n- stdin specified but not available â†’ clear error message\n\n## Benefits\n\nâœ… **Matches training data**: `gh issue create --body-file file.txt` is a common pattern\nâœ… **No shell escaping issues**: File content is read directly\nâœ… **Works with any content**: Markdown, special characters, quotes, etc.\nâœ… **Agent-friendly**: Agents already write complex content to temp files\nâœ… **User-friendly**: Easier for humans too when pasting long descriptions\n\n## Related Commands\n\nConsider adding similar support to:\n- `bd update --body-file` (for updating descriptions)\n- `bd comment --body-file` (if/when we add comments)\n\n## Examples\n\n```bash\n# From file\nbd create --title=\"Add new feature\" --body-file=feature.md\n\n# From stdin\necho \"Quick description\" | bd create --title=\"Bug fix\" --body-file=-\n\n# With other flags\nbd create \\\n  --title=\"Security issue\" \\\n  --type=bug \\\n  --priority=0 \\\n  --body-file=security-report.md \\\n  --label=security\n```\n\n## Testing\n\n- Test with normal files\n- Test with stdin (`-`)\n- Test with non-existent files (error handling)\n- Test with binary files (should handle gracefully)\n- Test with empty files (valid - empty description)\n- Test that `--description-file` and `--body-file` are equivalent aliases", "status": "open", "priority": 1, "issue_type": "feature", "created_at": "2025-11-22T00:02:08.762684-08:00", "updated_at": "2025-11-22T00:02:08.762684-08:00"}
{"id": "bd-io8c", "title": "Improve test coverage for internal/syncbranch (33.0% â†’ 70%)", "description": "The syncbranch package has only 33.0% test coverage. This package handles git sync operations and is critical for data integrity.\n\nCurrent coverage: 33.0%\nTarget coverage: 70%", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-13T20:43:02.079145-08:00", "updated_at": "2025-12-13T21:01:14.972533-08:00"}
{"id": "bd-iq7n", "title": "Audit and fix JSONL filename mismatches across all repo clones", "description": "## Problem\n\nMultiple clones of repos are configured with different JSONL filenames (issues.jsonl vs beads.jsonl), causing:\n1. JSONL files to be resurrected after deletion (one clone pushes issues.jsonl, another pushes beads.jsonl)\n2. Agents unable to see issues filed by other agents after sync\n3. Merge conflicts and data inconsistencies\n\n## Root Cause\n\nWhen repos were \"bd doctored\" or initialized at different times, some got issues.jsonl (old default) and others got beads.jsonl (Beads repo specific). These clones push their respective files, creating duplicates.\n\n## Task\n\nScan all repo clones under ~/src/ (1-2 levels deep) and standardize their JSONL configuration.\n\n### Step 1: Find all beads-enabled repos\n\n```bash\n# Find all directories named 'beads' at levels 1-2 under ~/src/\nfind ~/src -maxdepth 2 -type d -name beads\n```\n\n### Step 2: For each repo found, check configuration\n\nFor each directory from Step 1, check:\n- Does `.beads/metadata.json` exist?\n- What is the `jsonl_export` value?\n- What JSONL files actually exist in `.beads/`?\n- Are there multiple JSONL files (problem!)?\n\n### Step 3: Create audit report\n\nGenerate a report showing:\n```\nRepo Path                           | Config        | Actual Files           | Status\n----------------------------------- | ------------- | ---------------------- | --------\n~/src/beads                         | beads.jsonl   | beads.jsonl            | OK\n~/src/dave/beads                    | issues.jsonl  | issues.jsonl           | MISMATCH\n~/src/emma/beads                    | issues.jsonl  | issues.jsonl, beads.jsonl | DUPLICATE!\n```\n\n### Step 4: Determine canonical name for each repo\n\nFor repos that are the SAME git repository (check `git remote -v`):\n- Group them together\n- Determine which JSONL filename should be canonical (majority wins, or beads.jsonl for the beads repo itself)\n- List which clones need to be updated\n\n### Step 5: Generate fix script\n\nCreate a script that for each mismatched clone:\n1. Updates `.beads/metadata.json` to use the canonical name\n2. If JSONL file needs renaming: `git mv .beads/old.jsonl .beads/new.jsonl`\n3. Removes any duplicate JSONL files: `git rm .beads/duplicate.jsonl`\n4. Commits the change\n5. Syncs: `bd sync`\n\n### Expected Output\n\n1. Audit report showing all repos and their config status\n2. List of repos grouped by git remote (same repository)\n3. Fix script or manual instructions for standardizing each repo\n4. Verification that after fixes, all clones of the same repo use the same JSONL filename\n\n### Edge Cases\n\n- Handle repos without metadata.json (use default discovery)\n- Handle repos with no git remote (standalone/local)\n- Handle repos that are not git repositories\n- Don't modify repos with uncommitted changes (warn instead)\n\n### Success Criteria\n\n- All clones of the same git repository use the same JSONL filename\n- No duplicate JSONL files in any repo\n- All configurations documented in metadata.json\n- bd doctor passes on all repos", "status": "open", "priority": 0, "issue_type": "task", "created_at": "2025-11-21T23:58:35.044762-08:00", "updated_at": "2025-11-21T23:58:35.044762-08:00"}
{"id": "bd-j6lr", "title": "GH#402: Add --parent flag documentation to bd onboard", "description": "bd onboard output is missing --parent flag for epic subtasks. Agents guess wrong syntax (--deps parent:). See GitHub issue #402.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T01:03:56.594829-08:00", "updated_at": "2025-12-16T01:03:56.594829-08:00"}
{"id": "bd-jgxi", "title": "Auto-migrate database on CLI version bump", "description": "When CLI is upgraded (e.g., 0.24.0 â†’ 0.24.1), database version becomes stale. Add auto-migration in PersistentPreRun or daemon startup. Check dbVersion != CLIVersion and run bd migrate automatically. Fixes recurring UX issue where bd doctor shows version mismatch after every CLI upgrade.", "status": "open", "priority": 0, "issue_type": "feature", "created_at": "2025-11-21T23:16:09.004619-08:00", "updated_at": "2025-11-21T23:16:27.229388-08:00", "dependencies": [{"issue_id": "bd-jgxi", "depends_on_id": "bd-tbz3", "type": "parent-child", "created_at": "2025-11-21T23:16:09.005513-08:00", "created_by": "daemon"}]}
{"id": "bd-kwro", "title": "Beads Messaging & Knowledge Graph (v0.30.2)", "description": "Add messaging semantics and extended graph links to Beads, enabling it to serve as\nthe universal substrate for knowledge work - issues, messages, documents, and threads\nas nodes in a queryable graph.\n\n## Motivation\n\nGas Town (GGT) needs inter-agent communication. Rather than a separate mail system,\ncollapse messaging into Beads - one system, one sync, one query interface, all in git.\n\nThis also positions Beads as a foundation for:\n- Company-wide issue tracking (like Notion)\n- Threaded conversations (like Reddit/Slack)\n- Knowledge graphs with loose associations\n- Arbitrary workflow UIs built on top\n\n## New Issue Type\n\n**message** - ephemeral communication between workers\n- sender: who sent it\n- assignee: recipient\n- priority: P0 (urgent) to P4 (routine)\n- status: open (unread) -> closed (read)\n- ephemeral: true = can be bulk-deleted after swarm\n\n## New Graph Links\n\n**replies_to** - conversation threading\n- Messages reply to messages\n- Enables Reddit-style nested threads\n- Different from parent_id (not hierarchy, its conversation flow)\n\n**relates_to** - loose see also associations\n- Bidirectional knowledge graph edges\n- Not blocking, not hierarchical, just related\n- Enables discovery and traversal\n\n**duplicates** - deduplication at scale\n- Mark issue B as duplicate of canonical issue A\n- Close B, link to A\n- Essential for large issue databases\n\n**supersedes** - version chains\n- Design Doc v2 supersedes Design Doc v1\n- Track evolution of artifacts\n\n## New Fields (optional, any issue type)\n\n- sender (string) - who created this (for messages)\n- ephemeral (boolean) - can be bulk-deleted when closed\n\n## New Commands\n\nMessaging:\n- bd mail send <recipient> -s Subject -m Body\n- bd mail inbox (list open messages for me)\n- bd mail read <id> (show message content)\n- bd mail ack <id> (mark as read/close)\n- bd mail reply <id> -m Response (reply to thread)\n\nGraph links:\n- bd relate <id1> <id2> (create relates_to link)\n- bd duplicate <id> --of <canonical> (mark as duplicate)\n- bd supersede <id> --with <new> (mark superseded)\n\nCleanup:\n- bd cleanup --ephemeral (delete closed ephemeral issues)\n\n## Identity Configuration\n\nWorkers need identity for sender field:\n- BEADS_IDENTITY env var\n- Or .beads/config.json: identity field\n\n## Hooks (for GGT integration)\n\nBeads as platform - extensible without knowing about GGT.\nHook files in .beads/hooks/:\n- on_create (runs after bd create)\n- on_update (runs after bd update)\n- on_close (runs after bd close)\n- on_message (runs after bd mail send)\n\nGGT registers hooks to notify daemons of new messages.\n\n## Schema Changes (Migration Required)\n\nAdd to issue schema:\n- type: message (new valid type)\n- sender: string (optional)\n- ephemeral: boolean (optional)\n- replies_to: string (issue ID, optional)\n- relates_to: []string (issue IDs, optional)\n- duplicates: string (canonical issue ID, optional)\n- superseded_by: string (new issue ID, optional)\n\nMigration adds fields as optional - existing beads unchanged.\n\n## Success Criteria\n\n1. bd mail send/inbox/read/ack/reply work end-to-end\n2. replies_to creates proper thread structure\n3. relates_to, duplicates, supersedes links queryable\n4. Hooks fire on create/update/close/message\n5. Identity configurable via env or config\n6. Migration preserves all existing data\n7. All new features have tests", "status": "open", "priority": 0, "issue_type": "epic", "created_at": "2025-12-16T03:00:53.912223-08:00", "updated_at": "2025-12-16T03:00:53.912223-08:00"}
{"id": "bd-kwro.1", "title": "Schema: Add message type and new fields", "description": "Add to internal/storage/sqlite/schema.go and models:\n\nNew issue_type value:\n- message\n\nNew optional fields on Issue struct:\n- Sender string (who sent this)\n- Ephemeral bool (can be bulk-deleted)\n- RepliesTo string (issue ID for threading)\n- RelatesTo []string (issue IDs for knowledge graph)\n- Duplicates string (canonical issue ID)\n- SupersededBy string (replacement issue ID)\n\nUpdate:\n- internal/storage/sqlite/schema.go - add columns\n- internal/models/issue.go - add fields to struct\n- internal/storage/sqlite/sqlite.go - CRUD operations\n- Create migration from v0.30.1\n\nEnsure backward compatibility - all new fields optional.", "status": "open", "priority": 0, "issue_type": "task", "created_at": "2025-12-16T03:01:19.777604-08:00", "updated_at": "2025-12-16T03:01:19.777604-08:00", "dependencies": [{"issue_id": "bd-kwro.1", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:01:19.778314-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.10", "title": "Tests for messaging and graph links", "description": "Comprehensive test coverage for all new features.\n\nTest files:\n- cmd/bd/mail_test.go - mail command tests\n- internal/storage/sqlite/graph_links_test.go - graph link tests\n- internal/hooks/hooks_test.go - hook execution tests\n\nTest cases:\n- Mail send/inbox/read/ack lifecycle\n- Thread creation and traversal (replies_to)\n- Bidirectional relates_to\n- Duplicate marking and queries\n- Supersedes chains\n- Ephemeral cleanup\n- Identity resolution priority\n- Hook execution (mock hooks)\n- Schema migration preserves data\n\nTarget: >80% coverage on new code", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T03:02:34.050136-08:00", "updated_at": "2025-12-16T03:02:34.050136-08:00", "dependencies": [{"issue_id": "bd-kwro.10", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:34.050692-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.11", "title": "Documentation for messaging and graph links", "description": "Document all new features.\n\nFiles to update:\n- README.md - brief mention of messaging capability\n- AGENTS.md - update for AI agents using bd mail\n- docs/messaging.md (new) - full messaging reference\n- docs/graph-links.md (new) - graph link reference\n- CHANGELOG.md - v0.30.2 release notes\n\nTopics to cover:\n- Mail commands with examples\n- Graph link types and use cases\n- Identity configuration\n- Hooks setup for notifications\n- Migration notes", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T03:02:39.548518-08:00", "updated_at": "2025-12-16T03:02:39.548518-08:00", "dependencies": [{"issue_id": "bd-kwro.11", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:39.549055-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.2", "title": "Graph Link: replies_to for conversation threading", "description": "Implement replies_to link type for message threading.\n\nNew command:\n- bd mail reply <id> -m 'Response' creates a message with replies_to set\n\nQuery support:\n- bd show <id> --thread shows full conversation thread\n- Thread traversal in storage layer\n\nStorage:\n- replies_to column in issues table\n- Index for efficient thread queries\n\nThis enables Reddit-style nested threads where messages reply to other messages.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:01:25.292728-08:00", "updated_at": "2025-12-16T03:01:25.292728-08:00", "dependencies": [{"issue_id": "bd-kwro.2", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:01:25.293437-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.2", "depends_on_id": "bd-kwro.1", "type": "blocks", "created_at": "2025-12-16T03:02:51.866398-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.3", "title": "Graph Link: relates_to for knowledge graph", "description": "Implement relates_to link type for loose associations.\n\nNew command:\n- bd relate <id1> <id2> - creates bidirectional relates_to link\n\nQuery support:\n- bd show <id> --related shows related issues\n- bd list --related-to <id>\n\nStorage:\n- relates_to stored as JSON array of issue IDs\n- Consider: separate junction table for efficiency at scale?\n\nThis enables 'see also' connections without blocking or hierarchy.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:01:30.793115-08:00", "updated_at": "2025-12-16T03:01:30.793115-08:00", "dependencies": [{"issue_id": "bd-kwro.3", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:01:30.793709-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.3", "depends_on_id": "bd-kwro.1", "type": "blocks", "created_at": "2025-12-16T03:02:57.066355-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.4", "title": "Graph Link: duplicates for deduplication", "description": "Implement duplicates link type for marking issues as duplicates.\n\nNew command:\n- bd duplicate <id> --of <canonical> - marks id as duplicate of canonical\n- Auto-closes the duplicate issue\n\nQuery support:\n- bd show <id> shows 'Duplicate of: <canonical>'\n- bd list --duplicates shows all duplicate pairs\n\nStorage:\n- duplicates column pointing to canonical issue ID\n\nEssential for large issue databases with many similar reports.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:01:36.257223-08:00", "updated_at": "2025-12-16T03:01:36.257223-08:00", "dependencies": [{"issue_id": "bd-kwro.4", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:01:36.257714-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.4", "depends_on_id": "bd-kwro.1", "type": "blocks", "created_at": "2025-12-16T03:03:02.290163-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.5", "title": "Graph Link: supersedes for version chains", "description": "Implement supersedes link type for version tracking.\n\nNew command:\n- bd supersede <id> --with <new> - marks id as superseded by new\n- Auto-closes the superseded issue\n\nQuery support:\n- bd show <id> shows 'Superseded by: <new>'\n- bd show <new> shows 'Supersedes: <id>'\n- bd list --superseded shows version chains\n\nStorage:\n- superseded_by column pointing to replacement issue\n\nUseful for design docs, specs, and evolving artifacts.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:01:41.749294-08:00", "updated_at": "2025-12-16T03:01:41.749294-08:00", "dependencies": [{"issue_id": "bd-kwro.5", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:01:41.750015-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.5", "depends_on_id": "bd-kwro.1", "type": "blocks", "created_at": "2025-12-16T03:03:07.503583-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.6", "title": "Mail Commands: bd mail send/inbox/read/ack", "description": "Implement core mail commands in cmd/bd/mail.go\n\nCommands:\n- bd mail send <recipient> -s 'Subject' -m 'Body' [--urgent]\n  - Creates issue with type=message, sender=identity, assignee=recipient\n  - --urgent sets priority=0\n  \n- bd mail inbox [--from <sender>] [--priority <n>]\n  - Lists open messages where assignee=my identity\n  - Sorted by priority, then date\n  \n- bd mail read <id>\n  - Shows full message content (subject, body, sender, timestamp)\n  - Does NOT close (separate from ack)\n  \n- bd mail ack <id>\n  - Marks message as read by closing it\n  - Can ack multiple: bd mail ack <id1> <id2> ...\n\nRequires: Identity configuration (bd-kwro.7)", "status": "open", "priority": 0, "issue_type": "task", "created_at": "2025-12-16T03:02:12.103755-08:00", "updated_at": "2025-12-16T03:02:12.103755-08:00", "dependencies": [{"issue_id": "bd-kwro.6", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:12.104451-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.6", "depends_on_id": "bd-kwro.1", "type": "blocks", "created_at": "2025-12-16T03:03:12.693414-08:00", "created_by": "stevey"}, {"issue_id": "bd-kwro.6", "depends_on_id": "bd-kwro.7", "type": "blocks", "created_at": "2025-12-16T03:03:17.895705-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.7", "title": "Identity Configuration", "description": "Implement identity system for sender field.\n\nConfiguration sources (in priority order):\n1. --identity flag on commands\n2. BEADS_IDENTITY environment variable\n3. .beads/config.json: {\"identity\": \"worker-name\"}\n4. Default: git user.name or hostname\n\nNew config file support:\n- .beads/config.json for per-repo settings\n- identity field for messaging\n\nHelper function:\n- GetIdentity() string - resolves identity from sources\n\nUpdate bd mail send to use GetIdentity() for sender field.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:02:17.603608-08:00", "updated_at": "2025-12-16T03:02:17.603608-08:00", "dependencies": [{"issue_id": "bd-kwro.7", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:17.604343-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.8", "title": "Hooks System", "description": "Implement hook system for extensibility.\n\nHook directory: .beads/hooks/\nHook files (executable scripts):\n- on_create - runs after bd create\n- on_update - runs after bd update  \n- on_close - runs after bd close\n- on_message - runs after bd mail send\n\nHook invocation:\n- Pass issue ID as first argument\n- Pass event type as second argument\n- Pass JSON issue data on stdin\n- Run asynchronously (dont block command)\n\nExample hook (GGT notification):\n  #!/bin/bash\n  gt notify --event=$2 --issue=$1\n\nThis allows GGT to register notification handlers without Beads knowing about GGT.", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-16T03:02:23.086393-08:00", "updated_at": "2025-12-16T03:02:23.086393-08:00", "dependencies": [{"issue_id": "bd-kwro.8", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:23.087034-08:00", "created_by": "stevey"}]}
{"id": "bd-kwro.9", "title": "Cleanup: --ephemeral flag", "description": "Update bd cleanup to handle ephemeral issues.\n\nNew flag:\n- bd cleanup --ephemeral - deletes all CLOSED issues with ephemeral=true\n\nBehavior:\n- Only deletes if status=closed AND ephemeral=true\n- Respects --dry-run flag\n- Reports count of deleted ephemeral issues\n\nThis allows swarm cleanup to remove transient messages without affecting permanent issues.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T03:02:28.563871-08:00", "updated_at": "2025-12-16T03:02:28.563871-08:00", "dependencies": [{"issue_id": "bd-kwro.9", "depends_on_id": "bd-kwro", "type": "parent-child", "created_at": "2025-12-16T03:02:28.564466-08:00", "created_by": "stevey"}]}
{"id": "bd-l0pg", "title": "GH#483: Pre-commit hook should not fail when .beads exists but bd sync fails", "description": "Pre-commit hook exit 1 on bd sync --flush-only failure blocks commits even when user removed beads but .beads dir reappears. Should warn not fail. See: https://github.com/steveyegge/beads/issues/483", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:32:22.759225-08:00", "updated_at": "2025-12-14T16:52:49.799074-08:00"}
{"id": "bd-lfak", "title": "bd preflight: PR readiness checks for contributors", "description": "## Vision\n\nEncode project-specific institutional knowledge into executable checks. CONTRIBUTING.md is documentation that's read once and forgotten; `bd preflight` is documentation that runs at exactly the right moment.\n\n## Problem Statement\n\nContributors face a \"last mile\" problem - they do the work but stumble on project-specific gotchas at PR time:\n- Nix vendorHash gets stale when go.sum changes\n- Beads artifacts leak into PRs (see bd-umbf for namespace solution)\n- Version mismatches between version.go and default.nix\n- Tests/lint not run locally before pushing\n- Other project-specific checks that only surface when CI fails\n\nThese are too obscure to remember, exist in docs nobody reads end-to-end, and waste CI round-trips.\n\n## Why beads?\n\nBeads already has a foothold in the contributor workflow. It knows:\n- Git state (staged files, branch, dirty status)\n- Project structure\n- The specific issue being worked on\n- Project-specific configuration\n\n## Proposed Interface\n\n### Tier 1: Checklist Mode (v1)\n\n    $ bd preflight\n    PR Readiness Checklist:\n\n    [ ] Tests pass: go test -short ./...\n    [ ] Lint passes: golangci-lint run ./...\n    [ ] No beads pollution: check .beads/issues.jsonl diff\n    [ ] Nix hash current: go.sum unchanged or vendorHash updated\n    [ ] Version sync: version.go matches default.nix\n\n    Run 'bd preflight --check' to validate automatically.\n\n### Tier 2: Check Mode (v2)\n\n    $ bd preflight --check\n    âœ“ Tests pass\n    âœ“ Lint passes\n    âš  Beads pollution: 3 issues in diff - are these project issues or personal?\n    âœ— Nix hash stale: go.sum changed, vendorHash needs update\n      Fix: sha256-KRR6dXzsSw8OmEHGBEVDBOoIgfoZ2p0541T9ayjGHlI=\n    âœ“ Version sync\n\n    1 error, 1 warning. Run 'bd preflight --fix' to auto-fix where possible.\n\n### Tier 3: Fix Mode (v3)\n\n    $ bd preflight --fix\n    âœ“ Updated vendorHash in default.nix\n    âš  Cannot auto-fix beads pollution - manual review needed\n\n## Checks to Implement\n\n| Check | Description | Auto-fixable |\n|-------|-------------|--------------|\n| tests | Run go test -short ./... | No |\n| lint | Run golangci-lint | Partial (gofmt) |\n| beads-pollution | Detect personal issues in diff | No (see bd-umbf) |\n| nix-hash | Detect stale vendorHash | Yes (if nix available) |\n| version-sync | version.go matches default.nix | Yes |\n| no-debug | No TODO/FIXME/console.log | Warn only |\n| clean-stage | No unintended files staged | Warn only |\n\n## Future: Configuration\n\nMake checks configurable per-project via .beads/preflight.yaml:\n\n    preflight:\n      checks:\n        - name: tests\n          run: go test -short ./...\n          required: true\n        - name: no-secrets\n          pattern: \"**/*.env\"\n          staged: deny\n        - name: custom-check\n          run: ./scripts/validate.sh\n\nThis lets any project using beads define their own preflight checks.\n\n## Implementation Phases\n\n### Phase 1: Static Checklist\n- Implement bd preflight with hardcoded checklist for beads\n- No execution, just prints what to check\n- Update CONTRIBUTING.md to reference it\n\n### Phase 2: Automated Checks\n- Implement bd preflight --check\n- Run tests, lint, detect stale hashes\n- Clear pass/fail/warn output\n\n### Phase 3: Auto-fix\n- Implement bd preflight --fix\n- Fix vendorHash, version sync\n- Integrate with bd-umbf solution for pollution\n\n### Phase 4: Configuration\n- .beads/preflight.yaml support\n- Make it useful for other projects using beads\n- Plugin/hook system for custom checks\n\n## Dependencies\n\n- bd-umbf: Namespace isolation for beads pollution (blocking for full solution)\n\n## Success Metrics\n\n- Fewer CI failures on first PR push\n- Reduced \"fix nix hash\" commits\n- Contributors report preflight caught issues before CI", "status": "open", "priority": 2, "issue_type": "epic", "created_at": "2025-12-13T18:01:39.587078-08:00", "updated_at": "2025-12-13T18:01:39.587078-08:00", "dependencies": [{"issue_id": "bd-lfak", "depends_on_id": "bd-umbf", "type": "blocks", "created_at": "2025-12-13T18:01:46.059901-08:00", "created_by": "daemon"}]}
{"id": "bd-llfl", "title": "Improve test coverage for cmd/bd CLI (26.2% â†’ 50%)", "description": "The main CLI package (cmd/bd) has only 26.2% test coverage. CLI commands should have at least 50% coverage to ensure reliability.\n\nKey areas with low/no coverage:\n- daemon_autostart.go (multiple 0% functions)\n- compact.go (several 0% functions)\n- Various command handlers\n\nCurrent coverage: 26.2%\nTarget coverage: 50%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:03.123341-08:00", "updated_at": "2025-12-13T21:01:18.901944-08:00"}
{"id": "bd-lsv4", "title": "GH#444: Fix inconsistent status naming in_progress vs in-progress", "description": "Documentation uses in-progress (hyphen) but code expects in_progress (underscore). Update all docs to use canonical in_progress. See GitHub issue #444.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:14.349425-08:00", "updated_at": "2025-12-16T01:03:14.349425-08:00"}
{"id": "bd-lxzx", "title": "Add close_reason to JSONL export format documentation", "description": "PR #551 now persists close_reason to the database, but there's a question about whether this field should be exported to JSONL format.\n\n## Current State\n- close_reason is stored in issues.close_reason column\n- close_reason is also stored in events table (audit trail)\n- The JSONL export format may or may not include close_reason\n\n## Questions\n1. Should close_reason be exported to JSONL format?\n2. If yes, where should it go (root level or nested in events)?\n3. Should there be any special handling to avoid duplication?\n4. How should close_reason be handled during JSONL import?\n\n## Why This Matters\n- JSONL is the git-friendly sync format\n- Other beads instances import from JSONL\n- close_reason is meaningful data that should be preserved across clones\n\n## Suggested Action\n- Check if close_reason is currently exported in JSONL\n- If not, add it to the export schema\n- Document the field in JSONL format spec\n- Add tests for round-trip (export -> import -> verify close_reason)", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T14:25:17.414916-08:00", "updated_at": "2025-12-14T14:25:17.414916-08:00", "dependencies": [{"issue_id": "bd-lxzx", "depends_on_id": "bd-z86n", "type": "discovered-from", "created_at": "2025-12-14T14:25:17.416131-08:00", "created_by": "stevey"}]}
{"id": "bd-m8ro", "title": "Improve test coverage for internal/rpc (47.5% â†’ 60%)", "description": "The RPC package has only 47.5% test coverage. RPC is the communication layer for daemon operations.\n\nCurrent coverage: 47.5%\nTarget coverage: 60%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:09.515299-08:00", "updated_at": "2025-12-13T21:01:17.17404-08:00"}
{"id": "bd-mql4", "title": "getLocalSyncBranch silently ignores YAML parse errors", "description": "In autoimport.go:170-172, YAML parsing errors are silently ignored. If a user has malformed YAML in config.yaml, sync-branch will just silently be empty with no feedback.\n\nRecommendation: Add debug logging since this function is only called during auto-import, and debugging silent failures is painful.\n\nAdd: debug.Logf(\"Warning: failed to parse config.yaml: %v\", err)", "status": "open", "priority": 4, "issue_type": "task", "created_at": "2025-12-07T02:03:44.217728-08:00", "updated_at": "2025-12-07T02:03:44.217728-08:00"}
{"id": "bd-n386", "title": "Improve test coverage for internal/daemon (27.3% â†’ 60%)", "description": "The daemon package has only 27.3% test coverage. The daemon is critical for background operations and reliability.\n\nKey areas needing tests:\n- Daemon autostart logic\n- Socket handling\n- PID file management\n- Health checks\n\nCurrent coverage: 27.3%\nTarget coverage: 60%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:00.895238-08:00", "updated_at": "2025-12-13T21:01:17.274438-08:00"}
{"id": "bd-n4td", "title": "Add warning when staleness check errors", "description": "## Problem\n\nWhen ensureDatabaseFresh() calls CheckStaleness() and it errors (corrupted metadata, permission issues, etc.), we silently proceed with potentially stale data.\n\n**Location:** cmd/bd/staleness.go:27-32\n\n**Scenarios:**\n- Corrupted metadata table\n- Database locked by another process  \n- Permission issues reading JSONL file\n- Invalid last_import_time format in DB\n\n## Current Code\n\n```go\nisStale, err := autoimport.CheckStaleness(ctx, store, dbPath)\nif err \\!= nil {\n    // If we can't determine staleness, allow operation to proceed\n    // (better to show potentially stale data than block user)\n    return nil\n}\n```\n\n## Fix\n\n```go\nisStale, err := autoimport.CheckStaleness(ctx, store, dbPath)\nif err \\!= nil {\n    fmt.Fprintf(os.Stderr, \"Warning: Could not verify database freshness: %v\\n\", err)\n    fmt.Fprintf(os.Stderr, \"Proceeding anyway. Data may be stale.\\n\\n\")\n    return nil\n}\n```\n\n## Impact\nMedium - users should know when staleness check fails\n\n## Effort\nEasy - 5 minutes", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-11-20T20:16:34.889997-05:00", "updated_at": "2025-11-20T20:16:34.889997-05:00", "dependencies": [{"issue_id": "bd-n4td", "depends_on_id": "bd-2q6d", "type": "blocks", "created_at": "2025-11-20T20:18:20.154723-05:00", "created_by": "stevey"}]}
{"id": "bd-nl2", "title": "No logging/debugging for tombstone resurrection events", "description": "Per the design document bd-zvg Open Question 1: Should resurrection log a warning? Recommendation was Yes. Currently, when an expired tombstone loses to a live issue (resurrection), there is no logging or debugging output. This makes it hard to understand why an issue reappeared. Recommendation: Add optional debug logging when resurrection occurs, e.g., Issue bd-abc resurrected (tombstone expired). Files: internal/merge/merge.go:359-366, 371-378, 400-405, 410-415", "status": "open", "priority": 4, "issue_type": "feature", "created_at": "2025-12-05T16:36:52.27525-08:00", "updated_at": "2025-12-05T16:36:52.27525-08:00"}
{"id": "bd-nuh1", "title": "GH#403: bd doctor --fix circular error message", "description": "bd doctor --fix suggests running bd doctor --fix for deletions manifest issue. Fix to provide actual resolution. See GitHub issue #403.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:16.290018-08:00", "updated_at": "2025-12-16T01:03:16.290018-08:00"}
{"id": "bd-o4qy", "title": "Improve CheckStaleness error handling", "description": "## Problem\n\nCheckStaleness returns 'false' (not stale) for multiple error conditions instead of returning errors. This masks problems.\n\n**Location:** internal/autoimport/autoimport.go:253-285\n\n## Edge Cases That Return False\n\n1. **Invalid last_import_time format** (line 259-262)\n2. **No JSONL file found** (line 267-277)  \n3. **JSONL stat fails** (line 279-282)\n\n## Fix\n\nReturn errors for abnormal conditions:\n\n```go\nlastImportTime, err := time.Parse(time.RFC3339, lastImportStr)\nif err != nil {\n    return false, fmt.Errorf(\"corrupted last_import_time: %w\", err)\n}\n\nif jsonlPath == \"\" {\n    return false, fmt.Errorf(\"no JSONL file found\")\n}\n\nstat, err := os.Stat(jsonlPath)\nif err != nil {\n    return false, fmt.Errorf(\"cannot stat JSONL: %w\", err)\n}\n```\n\n## Impact\nMedium - edge cases are rare but should be handled\n\n## Effort  \n30 minutes - requires updating callers in RPC server", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-11-20T20:17:27.606219-05:00", "updated_at": "2025-11-20T20:17:27.606219-05:00", "dependencies": [{"issue_id": "bd-o4qy", "depends_on_id": "bd-2q6d", "type": "blocks", "created_at": "2025-11-20T20:18:26.81065-05:00", "created_by": "stevey"}]}
{"id": "bd-o55a", "title": "GH#509: bd doesn't find .beads when running from nested worktrees", "description": "When worktrees are nested under main repo (.worktrees/feature/), bd stops at worktree git root instead of continuing to find .beads in parent. See GitHub issue #509 for detailed fix suggestion.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:20.281591-08:00", "updated_at": "2025-12-16T01:03:20.281591-08:00"}
{"id": "bd-ola6", "title": "Implement transaction retry logic for SQLITE_BUSY", "description": "BEGIN IMMEDIATE fails immediately on SQLITE_BUSY instead of retrying with exponential backoff.\n\nLocation: internal/storage/sqlite/sqlite.go:223-225\n\nProblem:\n- Under concurrent write load, BEGIN IMMEDIATE can fail with SQLITE_BUSY\n- Current implementation fails immediately instead of retrying\n- Results in spurious failures under normal concurrent usage\n\nSolution: Implement exponential backoff retry:\n- Retry up to N times (e.g., 5)\n- Backoff: 10ms, 20ms, 40ms, 80ms, 160ms\n- Check for context cancellation between retries\n- Only retry on SQLITE_BUSY/database locked errors\n\nImpact: Spurious failures under concurrent write load\n\nEffort: 3 hours", "status": "open", "priority": 1, "issue_type": "feature", "created_at": "2025-11-16T14:51:31.247147-08:00", "updated_at": "2025-11-16T14:51:31.247147-08:00"}
{"id": "bd-otf4", "title": "Code Review: PR #481 - Context Engineering Optimizations", "description": "Comprehensive code review of the merged context engineering PR (PR #481) that reduces MCP context usage by 80-90%.\n\n## Summary\nThe PR successfully implements lazy tool schema loading and minimal issue models to reduce context window usage. Overall implementation is solid and well-tested.\n\n## Positive Findings\nâœ… Well-designed models (IssueMinimal, CompactedResult)\nâœ… Comprehensive test coverage (28 tests, all passing)\nâœ… Clear documentation and comments\nâœ… Backward compatibility preserved (show() still returns full Issue)\nâœ… Sensible defaults (COMPACTION_THRESHOLD=20, PREVIEW_COUNT=5)\nâœ… Tool catalog complete with all 15 tools documented\n\n## Issues Identified\nSee linked issues for specific followup tasks.\n\n## Context Engineering Architecture\n- discover_tools(): List tool names only (~500 bytes vs ~15KB)\n- get_tool_info(name): Get specific tool details on-demand\n- IssueMinimal: Lightweight model for list views (~80 bytes vs ~400 bytes)\n- CompactedResult: Auto-compacts results with >20 issues\n- _to_minimal(): Conversion function (efficient, no N+1 issues)", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T14:24:13.523532-08:00", "updated_at": "2025-12-14T14:24:13.523532-08:00"}
{"id": "bd-pdr2", "title": "Consider backwards compatibility for ready() and list() return type change", "description": "PR #481 changed the return types of `ready()` and `list()` from `list[Issue]` to `list[IssueMinimal] | CompactedResult`. This is a breaking change for MCP clients.\n\n## Impact Assessment\nBreaking change affects:\n- Any MCP client expecting `list[Issue]` from ready()\n- Any MCP client expecting `list[Issue]` from list()\n- Client code that accesses full Issue fields (description, design, acceptance_criteria, timestamps, dependencies, dependents)\n\n## Current Behavior\n- ready() returns `list[IssueMinimal] | CompactedResult`\n- list() returns `list[IssueMinimal] | CompactedResult`\n- show() still returns full `Issue` (good)\n\n## Considerations\n**Pros of current approach:**\n- Forces clients to use show() for full details (good for context efficiency)\n- Simple mental model (always use show for full data)\n- Documentation warns about this\n\n**Cons:**\n- Clients expecting list[Issue] will break\n- No graceful degradation option\n- No migration period\n\n## Potential Solutions\n1. Add optional parameter `full_details=false` to ready/list (would increase payload)\n2. Create separate tools: ready_minimal/list_minimal + ready_full/list_full\n3. Accept breaking change and document upgrade path (current approach)\n4. Version the MCP server and document migration guide\n\n## Recommendation\nCurrent approach (solution 3) is reasonable if:\n- Changelog clearly documents the breaking change\n- Migration guide provided to clients\n- Error handling is graceful for clients expecting specific fields", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T14:24:56.460465-08:00", "updated_at": "2025-12-14T14:24:56.460465-08:00", "dependencies": [{"issue_id": "bd-pdr2", "depends_on_id": "bd-otf4", "type": "discovered-from", "created_at": "2025-12-14T14:24:56.461959-08:00", "created_by": "stevey"}]}
{"id": "bd-r46", "title": "Support --reason flag in daemon mode for reopen command", "description": "The reopen.go command has a TODO at line 61 to add reason as a comment once RPC supports AddComment. Currently --reason flag is ignored in daemon mode with a warning.", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-11-21T18:55:10.773626-05:00", "updated_at": "2025-11-21T18:55:10.773626-05:00"}
{"id": "bd-sh4c", "title": "Improve test coverage for cmd/bd/setup (28.4% â†’ 50%)", "description": "The setup package has only 28.4% test coverage. Setup commands are critical for first-time user experience.\n\nCurrent coverage: 28.4%\nTarget coverage: 50%", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-13T20:43:04.409346-08:00", "updated_at": "2025-12-13T21:01:18.98833-08:00"}
{"id": "bd-siz1", "title": "GH#532: bd sync circular error (suggests running bd sync)", "description": "bd sync error message recommends running bd sync to fix the bd sync error. Fix error handling to provide useful guidance. See GitHub issue #532.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:04:00.543573-08:00", "updated_at": "2025-12-16T01:04:00.543573-08:00"}
{"id": "bd-svb5", "title": "GH#505: Add bd reset/wipe command", "description": "Add command to cleanly reset/wipe beads database. User reports painful manual process to start fresh. See GitHub issue #505.", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-12-16T01:03:42.160966-08:00", "updated_at": "2025-12-16T01:03:42.160966-08:00"}
{"id": "bd-t4u1", "title": "False positive detection by Kaspersky Antivirus (Trojan)", "description": "Kaspersky Antivirus falsely detects beads (bd.exe v0.23.1) as a Trojan (PDM:Trojan.Win32.Generic) and removes it.\nEvent: Malicious object detected\nComponent: System Watcher\nObject name: bd.exe\n", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-11-20T18:56:12.498187-05:00", "updated_at": "2025-11-20T18:56:12.498187-05:00"}
{"id": "bd-tbz3", "title": "bd init UX Improvements", "description": "bd init leaves users with incomplete setup, requiring manual bd doctor --fix. Issues found: (1) git hooks not installed if user declines prompt, (2) no auto-migration when CLI is upgraded, (3) stale merge driver configs from old versions. Fix by making bd init more robust with better defaults and auto-migration.", "status": "open", "priority": 1, "issue_type": "epic", "created_at": "2025-11-21T23:16:00.333543-08:00", "updated_at": "2025-11-21T23:16:37.811233-08:00"}
{"id": "bd-thgk", "title": "Improve test coverage for internal/compact (18.2% â†’ 70%)", "description": "The compact package has only 18.2% test coverage. This is a core package handling issue compaction and should have at least 70% coverage.\n\nKey functions needing tests:\n- runCompactSingle (0%)\n- runCompactAll (0%)\n- runCompactRPC (0%)\n- runCompactStatsRPC (0%)\n- runCompactAnalyze (0%)\n- runCompactApply (0%)\n- pruneDeletionsManifest (0%)\n\nCurrent coverage: 18.2%\nTarget coverage: 70%", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-13T20:42:58.455767-08:00", "updated_at": "2025-12-13T21:01:15.070551-08:00"}
{"id": "bd-tm2p", "title": "Polecats get stuck on interactive shell prompts (cp/mv/rm -i)", "description": "During swarm operations, polecats frequently get stuck waiting for interactive prompts from shell commands like:\n- cp prompting 'overwrite file? (y/n)'\n- mv prompting 'overwrite file? (y/n)'  \n- rm prompting 'remove file?'\n\nThis happens because macOS aliases or shell configs may have -i flags set by default.\n\nRoot cause: Claude Code runs commands that trigger interactive confirmation prompts, but cannot respond to them, causing the agent to hang indefinitely.\n\nObserved in: Multiple polecats during GH issues swarm (Dec 2024)\n- Derrick, Roustabout, Prospector, Warboy all got stuck on y/n prompts\n\nSuggested fixes:\n1. AGENTS.md should instruct agents to always use -f flag with cp/mv/rm\n2. Polecat startup could set shell aliases to use non-interactive versions\n3. bd prime hook could include guidance about non-interactive commands\n4. Consider detecting stuck prompts and auto-recovering", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-12-14T16:51:24.572271-08:00", "updated_at": "2025-12-14T16:51:24.572271-08:00"}
{"id": "bd-tvu3", "title": "Improve test coverage for internal/beads (48.1% â†’ 70%)", "description": "The beads package is a core package with 48.1% coverage. As the primary package for issue management, it should have at least 70% coverage.\n\nCurrent coverage: 48.1%\nTarget coverage: 70%", "status": "open", "priority": 1, "issue_type": "task", "created_at": "2025-12-13T20:42:59.739142-08:00", "updated_at": "2025-12-13T21:01:14.874359-08:00"}
{"id": "bd-u0g9", "title": "GH#405: Prefix parsing with hyphens treats first segment as prefix", "description": "Prefix me-py-toolkit gets parsed as just me- when detecting mismatches. Fix prefix parsing to handle multi-hyphen prefixes. See GitHub issue #405.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:18.354066-08:00", "updated_at": "2025-12-16T01:03:18.354066-08:00"}
{"id": "bd-umbf", "title": "Design contributor namespace isolation for beads pollution prevention", "description": "## Problem\n\nWhen contributors work on beads-the-project using beads-the-tool, their personal work-tracking issues leak into PRs. The .beads/issues.jsonl is intentionally tracked (it's the project's issue database), but contributors' local issues pollute the diff.\n\nThis is a recursion problem unique to self-hosting projects.\n\n## Possible Solutions to Explore\n\n1. **Contributor namespaces** - Each contributor gets a private prefix (e.g., `bd-steve-xxxx`) that's gitignored or filtered\n2. **Separate database** - Contributors use BEADS_DIR pointing elsewhere for personal tracking\n3. **Issue ownership/visibility flags** - Mark issues as \"local-only\" vs \"project\"\n4. **Prefix-based filtering** - Configure which prefixes are committed vs ignored\n\n## Design Considerations\n\n- Should be zero-friction for contributors (no manual setup)\n- Must not break existing workflows\n- Needs to work with sync/collaboration features\n- Consider: what if a \"personal\" issue graduates to \"project\" issue?\n\n## Expansion Needed\n\nThis is a placeholder. Needs detailed design exploration before implementation.", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-12-13T18:00:29.638743-08:00", "updated_at": "2025-12-13T18:00:41.345673-08:00"}
{"id": "bd-vckm", "title": "Improve sync branch divergence recovery UX", "description": "When the sync branch diverges significantly from remote (e.g., 89 local vs 36 remote commits), bd sync fails with a confusing rebase conflict error.\n\n**Current behavior:**\n```\nError committing to sync branch: failed to push from worktree: push failed and recovery rebase also failed\nerror: could not apply 8712f35... bd sync: 2025-12-13 07:30:04\nCONFLICT (content): Merge conflict in .beads/issues.jsonl\n```\n\nUser is left in a broken state with no clear recovery path.\n\n**Expected behavior:**\n1. Detect significant divergence before attempting sync\n2. Offer options: 'Sync branch diverged. Choose: (1) Reset to remote (2) Force push local (3) Manual merge'\n3. Provide clear recovery commands if automatic recovery fails\n\n**Context:** This happened after multiple clones synced different states. The workaround was manually resetting the sync branch worktree to remote.", "status": "closed", "priority": 3, "issue_type": "feature", "created_at": "2025-12-15T17:29:01.803478-08:00", "updated_at": "2025-12-16T01:04:45.251662-08:00", "closed_at": "2025-12-16T01:04:45.251662-08:00", "close_reason": "Added --reset-remote and --force-push flags with better divergence error messages"}
{"id": "bd-wsqt", "title": "bd sync outputs excessive 'Skipping' messages for tombstoned issues", "description": "During sync, every tombstoned issue outputs a 'Skipping bd-xxx (in deletions manifest)' message. With 96+ tombstones, this creates ~200 lines of noise that obscures the actual sync status.\n\n**Current behavior:**\n```\nSkipping bd-0ih (in deletions manifest: deleted 0001-01-01 by )\nSkipping bd-0is (in deletions manifest: deleted 0001-01-01 by )\n... (96 more lines)\nâœ“ Sync complete\n```\n\n**Expected behavior:**\n- Suppress individual skip messages by default\n- Show summary: 'Skipped 96 tombstoned issues'\n- Or add --verbose flag to show individual skips\n\n**Impact:** Makes sync output unreadable, hard to spot actual errors or warnings.", "status": "closed", "priority": 2, "issue_type": "bug", "created_at": "2025-12-15T17:28:34.592319-08:00", "updated_at": "2025-12-16T00:41:33.166393-08:00", "closed_at": "2025-12-16T00:41:33.166393-08:00", "close_reason": "Fixed: doctor --fix now removes hydrated issues from deletions manifest; sync now shows summary instead of per-issue skip messages"}
{"id": "bd-xctp", "title": "GH#519: bd sync fails when sync.branch is currently checked-out branch", "description": "", "status": "closed", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:06:05.319281-08:00", "updated_at": "2025-12-16T01:09:33.691906-08:00", "closed_at": "2025-12-16T01:09:33.691906-08:00"}
{"id": "bd-xj2e", "title": "GH#522: Add --type flag to bd update command", "description": "Add --type flag to bd update for changing issue type (task/epic/bug/feature). Storage layer already supports it. See GitHub issue #522.", "status": "closed", "priority": 2, "issue_type": "task", "created_at": "2025-12-16T01:03:12.506583-08:00", "updated_at": "2025-12-16T02:19:57.235174-08:00", "closed_at": "2025-12-16T01:21:47.72135-08:00"}
{"id": "bd-xoyh", "title": "GH#519: bd sync fails when sync.branch equals current branch", "description": "bd sync tries to create worktree when sync.branch matches current checkout, fails with 'already used by worktree'. Should detect and commit directly. See: https://github.com/steveyegge/beads/issues/519", "status": "in_progress", "priority": 2, "issue_type": "bug", "created_at": "2025-12-14T16:31:34.574414-08:00", "updated_at": "2025-12-14T16:52:49.800357-08:00"}
{"id": "bd-y2v", "title": "Refactor duplicate JSONL-from-git parsing code", "description": "Both readFirstIssueFromGit() in init.go and importFromGit() in autoimport.go have similar code patterns for:\n1. Running git show <ref>:<path>\n2. Scanning the output with bufio.Scanner\n3. Parsing JSON lines\n\nCould be refactored to share a helper like:\n- readJSONLFromGit(gitRef, path string) ([]byte, error)\n- Or a streaming version: streamJSONLFromGit(gitRef, path string) (io.Reader, error)\n\nFiles:\n- cmd/bd/autoimport.go:225-256 (importFromGit)\n- cmd/bd/init.go:1212-1243 (readFirstIssueFromGit)\n\nPriority is low since code duplication is minimal and both functions work correctly.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-05T14:51:18.41124-08:00", "updated_at": "2025-12-05T14:51:18.41124-08:00"}
{"id": "bd-y6t6", "title": "GH#524: Package for Windows (winget)", "description": "Request to publish beads on winget for easy Windows installation. See: https://github.com/steveyegge/beads/issues/524", "status": "in_progress", "priority": 3, "issue_type": "feature", "created_at": "2025-12-14T16:31:28.596258-08:00", "updated_at": "2025-12-14T16:52:49.798255-08:00"}
{"id": "bd-ykd9", "title": "Add bd doctor --fix flag to automatically repair issues", "description": "Implement a --fix flag for bd doctor that can automatically repair detected issues.\n\nRequirements:\n- Add --fix flag to bd doctor command\n- Show all fixable issues and prompt for confirmation before applying fixes\n- Organize fix implementations under doctor/fix/<type_of_fix>.go\n- Each fix type should have its own file (e.g., doctor/fix/hooks.go, doctor/fix/sync.go)\n- Display what will be fixed and ask user to confirm (Y/n) before proceeding\n- Support fixing issues like:\n  - Missing or broken git hooks\n  - Sync problems with remote\n  - File permission issues\n  - Any other auto-repairable issues doctor detects\n\nImplementation notes:\n- Maintain separation between detection (existing doctor code) and repair (new fix code)\n- Each fix should be idempotent and safe to run multiple times\n- Provide clear output about what was fixed\n- Log any fixes that fail with actionable error messages", "status": "open", "priority": 2, "issue_type": "feature", "created_at": "2025-11-14T18:17:48.411264-08:00", "updated_at": "2025-11-14T18:17:58.88609-08:00"}
{"id": "bd-z86n", "title": "Code Review: PR #551 - Persist close_reason to issues table", "description": "Code review of PR #551 which fixes close_reason persistence bug.\n\n## Summary\nThe PR correctly fixes a bug where close_reason was only stored in the events table, not in the issues.close_reason column. This caused `bd show --json` to return empty close_reason.\n\n## What Was Fixed\n- âœ… CloseIssue now updates both close_reason and closed_at\n- âœ… ReOpenIssue clears both close_reason and closed_at\n- âœ… Comprehensive tests added for both storage and CLI layers\n- âœ… Clear documentation in queries.go about dual storage strategy\n\n## Quality Assessment\nâœ… Tests cover both storage layer and CLI JSON output\nâœ… Handles reopen case (clearing close_reason)\nâœ… Good comments explaining dual-storage design\nâœ… No known issues\n\n## Potential Followups\nSee linked issues for suggestions.", "status": "open", "priority": 2, "issue_type": "task", "created_at": "2025-12-14T14:25:06.887069-08:00", "updated_at": "2025-12-14T14:25:06.887069-08:00"}
{"id": "bd-z8a6", "title": "bd delete --from-file should add deleted issues to deletions manifest", "description": "When using bd delete --from-file to bulk delete issues, the deleted issue IDs are not being added to the deletions.jsonl manifest.\n\nThis causes those issues to be resurrected during bd sync when git history scanning finds them in old commits.\n\nExpected: All deleted issues should be added to deletions.jsonl so they wont be reimported from git history.\n\nWorkaround: Manually add deletion records to deletions.jsonl.", "status": "open", "priority": 1, "issue_type": "bug", "created_at": "2025-12-16T01:48:14.099855-08:00", "updated_at": "2025-12-16T01:48:14.099855-08:00"}
{"id": "bd-zbyb", "title": "GH#522: Add --type flag to bd update command", "description": "Allow changing issue type (task/epic/bug/feature) via bd update --type. Storage layer already supports it. Needed for TUI tools like Abacus. See: https://github.com/steveyegge/beads/issues/522", "status": "in_progress", "priority": 2, "issue_type": "feature", "created_at": "2025-12-14T16:31:31.71456-08:00", "updated_at": "2025-12-14T16:52:49.797533-08:00"}
{"id": "bd-ziy5", "title": "GH#409: bd init uses issues.jsonl but docs say beads.jsonl", "description": "bd init creates config referencing issues.jsonl but README/docs reference beads.jsonl as canonical. Standardize naming. See GitHub issue #409.", "status": "open", "priority": 2, "issue_type": "bug", "created_at": "2025-12-16T01:03:58.109954-08:00", "updated_at": "2025-12-16T01:03:58.109954-08:00"}
{"id": "bd-zsle", "title": "GH#516: Automate 'landing the plane' setup in AGENTS.md", "description": "bd init or /beads:init should auto-add landing-the-plane instructions to AGENTS.md (and @AGENTS.md for web Claude). Reduces manual setup. See: https://github.com/steveyegge/beads/issues/516", "status": "in_progress", "priority": 2, "issue_type": "feature", "created_at": "2025-12-14T16:31:57.541154-08:00", "updated_at": "2025-12-14T16:52:49.79956-08:00"}
{"id": "bd-zwtq", "title": "Run bd doctor at end of bd init to verify setup", "description": "Run bd doctor diagnostics at end of bd init (after line 398 in init.go). If issues found, warn user immediately: 'âš  Setup incomplete. Run bd doctor --fix to complete setup.' Catches configuration problems before user encounters them in normal workflow.", "status": "open", "priority": 1, "issue_type": "feature", "created_at": "2025-11-21T23:16:09.596778-08:00", "updated_at": "2025-11-21T23:16:27.781976-08:00", "dependencies": [{"issue_id": "bd-zwtq", "depends_on_id": "bd-tbz3", "type": "parent-child", "created_at": "2025-11-21T23:16:09.597617-08:00", "created_by": "daemon"}]}
